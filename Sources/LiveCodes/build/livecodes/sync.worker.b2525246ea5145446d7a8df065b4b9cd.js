(function(){var ri=Object.create;var zn=Object.defineProperty;var si=Object.getOwnPropertyDescriptor;var oi=Object.getOwnPropertyNames;var ii=Object.getPrototypeOf,ci=Object.prototype.hasOwnProperty;var ai=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),li=(e,t)=>{for(var n in t)zn(e,n,{get:t[n],enumerable:!0})},di=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of oi(t))!ci.call(e,s)&&s!==n&&zn(e,s,{get:()=>t[s],enumerable:!(r=si(t,s))||r.enumerable});return e};var ui=(e,t,n)=>(n=e!=null?ri(ii(e)):{},di(t||!e||!e.__esModule?zn(n,"default",{value:e,enumerable:!0}):n,e));var Xo=ai((Jr,Yo)=>{(function(e,t){var n=t(e);if(typeof define=="function"&&define.amd)define("DeepDiff",function(){return n});else if(typeof Jr=="object"||typeof navigator=="object"&&navigator.product.match(/ReactNative/i))Yo.exports=n;else{var r=e.DeepDiff;n.noConflict=function(){return e.DeepDiff===n&&(e.DeepDiff=r),n},e.DeepDiff=n}})(Jr,function(e){var t=["N","E","A","D"];function n(g,m){g.super_=m,g.prototype=Object.create(m.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}function r(g,m){Object.defineProperty(this,"kind",{value:g,enumerable:!0}),m&&m.length&&Object.defineProperty(this,"path",{value:m,enumerable:!0})}function s(g,m,p){s.super_.call(this,"E",g),Object.defineProperty(this,"lhs",{value:m,enumerable:!0}),Object.defineProperty(this,"rhs",{value:p,enumerable:!0})}n(s,r);function o(g,m){o.super_.call(this,"N",g),Object.defineProperty(this,"rhs",{value:m,enumerable:!0})}n(o,r);function i(g,m){i.super_.call(this,"D",g),Object.defineProperty(this,"lhs",{value:m,enumerable:!0})}n(i,r);function c(g,m,p){c.super_.call(this,"A",g),Object.defineProperty(this,"index",{value:m,enumerable:!0}),Object.defineProperty(this,"item",{value:p,enumerable:!0})}n(c,r);function a(g,m,p){var b=g.slice((p||m)+1||g.length);return g.length=m<0?g.length+m:m,g.push.apply(g,b),g}function l(g){var m=typeof g;return m!=="object"?m:g===Math?"math":g===null?"null":Array.isArray(g)?"array":Object.prototype.toString.call(g)==="[object Date]"?"date":typeof g.toString=="function"&&/^\/.*\//.test(g.toString())?"regexp":"object"}function d(g){var m=0;if(g.length===0)return m;for(var p=0;p<g.length;p++){var b=g.charCodeAt(p);m=(m<<5)-m+b,m=m&m}return m}function u(g){var m=0,p=l(g);if(p==="array"){g.forEach(function(Rt){m+=u(Rt)});var b="[type: array, hash: "+m+"]";return m+d(b)}if(p==="object"){for(var w in g)if(g.hasOwnProperty(w)){var _="[ type: object, key: "+w+", value hash: "+u(g[w])+"]";m+=d(_)}return m}var C="[ type: "+p+" ; value: "+g+"]";return m+d(C)}function h(g,m,p,b,w,_,C,Rt){p=p||[],w=w||[],C=C||[];var V=w.slice(0);if(typeof _<"u"&&_!==null){if(b){if(typeof b=="function"&&b(V,_))return;if(typeof b=="object"){if(b.prefilter&&b.prefilter(V,_))return;if(b.normalize){var Fn=b.normalize(V,_,g,m);Fn&&(g=Fn[0],m=Fn[1])}}}V.push(_)}l(g)==="regexp"&&l(m)==="regexp"&&(g=g.toString(),m=m.toString());var $n=typeof g,ni=typeof m,j,ke,rt,Ue,Yr=$n!=="undefined"||C&&C.length>0&&C[C.length-1].lhs&&Object.getOwnPropertyDescriptor(C[C.length-1].lhs,_),Xr=ni!=="undefined"||C&&C.length>0&&C[C.length-1].rhs&&Object.getOwnPropertyDescriptor(C[C.length-1].rhs,_);if(!Yr&&Xr)p.push(new o(V,m));else if(!Xr&&Yr)p.push(new i(V,g));else if(l(g)!==l(m))p.push(new s(V,g,m));else if(l(g)==="date"&&g-m!==0)p.push(new s(V,g,m));else if($n==="object"&&g!==null&&m!==null){for(j=C.length-1;j>-1;--j)if(C[j].lhs===g){Ue=!0;break}if(Ue)g!==m&&p.push(new s(V,g,m));else{if(C.push({lhs:g,rhs:m}),Array.isArray(g)){for(Rt&&(g.sort(function(Pn,qn){return u(Pn)-u(qn)}),m.sort(function(Pn,qn){return u(Pn)-u(qn)})),j=m.length-1,ke=g.length-1;j>ke;)p.push(new c(V,j,new o(void 0,m[j--])));for(;ke>j;)p.push(new c(V,ke,new i(void 0,g[ke--])));for(;j>=0;--j)h(g[j],m[j],p,b,V,j,C,Rt)}else{var Qr=Object.keys(g),en=Object.keys(m);for(j=0;j<Qr.length;++j)rt=Qr[j],Ue=en.indexOf(rt),Ue>=0?(h(g[rt],m[rt],p,b,V,rt,C,Rt),en[Ue]=null):h(g[rt],void 0,p,b,V,rt,C,Rt);for(j=0;j<en.length;++j)rt=en[j],rt&&h(void 0,m[rt],p,b,V,rt,C,Rt)}C.length=C.length-1}}else g!==m&&($n==="number"&&isNaN(g)&&isNaN(m)||p.push(new s(V,g,m)))}function f(g,m,p,b,w){var _=[];if(h(g,m,_,b,null,null,null,w),p)for(var C=0;C<_.length;++C)p(_[C]);return _}function y(g,m,p,b,w,_,C){return h(g,m,p,b,w,_,C,!0)}function x(g,m,p,b){var w=b?function(C){C&&b.push(C)}:void 0,_=f(g,m,w,p);return b||(_.length?_:void 0)}function U(g,m,p,b){var w=b?function(C){C&&b.push(C)}:void 0,_=f(g,m,w,p,!0);return b||(_.length?_:void 0)}function v(g,m,p){if(p.path&&p.path.length){var b=g[m],w,_=p.path.length-1;for(w=0;w<_;w++)b=b[p.path[w]];switch(p.kind){case"A":v(b[p.path[w]],p.index,p.item);break;case"D":delete b[p.path[w]];break;case"E":case"N":b[p.path[w]]=p.rhs;break}}else switch(p.kind){case"A":v(g[m],p.index,p.item);break;case"D":g=a(g,m);break;case"E":case"N":g[m]=p.rhs;break}return g}function D(g,m,p){if(typeof p>"u"&&m&&~t.indexOf(m.kind)&&(p=m),g&&p&&p.kind){for(var b=g,w=-1,_=p.path?p.path.length-1:0;++w<_;)typeof b[p.path[w]]>"u"&&(b[p.path[w]]=typeof p.path[w+1]<"u"&&typeof p.path[w+1]=="number"?[]:{}),b=b[p.path[w]];switch(p.kind){case"A":p.path&&typeof b[p.path[w]]>"u"&&(b[p.path[w]]=[]),v(p.path?b[p.path[w]]:b,p.index,p.item);break;case"D":delete b[p.path[w]];break;case"E":case"N":b[p.path[w]]=p.rhs;break}}}function B(g,m,p){if(p.path&&p.path.length){var b=g[m],w,_=p.path.length-1;for(w=0;w<_;w++)b=b[p.path[w]];switch(p.kind){case"A":B(b[p.path[w]],p.index,p.item);break;case"D":b[p.path[w]]=p.lhs;break;case"E":b[p.path[w]]=p.lhs;break;case"N":delete b[p.path[w]];break}}else switch(p.kind){case"A":B(g[m],p.index,p.item);break;case"D":g[m]=p.lhs;break;case"E":g[m]=p.lhs;break;case"N":g=a(g,m);break}return g}function Zr(g,m,p){if(g&&m&&p&&p.kind){var b=g,w,_;for(_=p.path.length-1,w=0;w<_;w++)typeof b[p.path[w]]>"u"&&(b[p.path[w]]={}),b=b[p.path[w]];switch(p.kind){case"A":B(b[p.path[w]],p.index,p.item);break;case"D":b[p.path[w]]=p.lhs;break;case"E":b[p.path[w]]=p.lhs;break;case"N":delete b[p.path[w]];break}}}function ne(g,m,p){if(g&&m){var b=function(w){(!p||p(g,m,w))&&D(g,m,w)};f(g,m,b)}}return Object.defineProperties(x,{diff:{value:x,enumerable:!0},orderIndependentDiff:{value:U,enumerable:!0},observableDiff:{value:f,enumerable:!0},orderIndependentObservableDiff:{value:y,enumerable:!0},orderIndepHash:{value:u,enumerable:!0},applyDiff:{value:ne,enumerable:!0},applyChange:{value:D,enumerable:!0},revertChange:{value:Zr,enumerable:!0},isConflict:{value:function(){return typeof $conflict<"u"},enumerable:!0}}),x.DeepDiff=x,e&&(e.DeepDiff=x),x})});var hi=typeof btoa=="function",Hn=typeof Buffer=="function",sl=typeof TextDecoder=="function"?new TextDecoder:void 0,ts=typeof TextEncoder=="function"?new TextEncoder:void 0,fi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ee=Array.prototype.slice.call(fi),ol=(e=>{let t={};return e.forEach((n,r)=>t[n]=r),t})(Ee);var ct=String.fromCharCode.bind(String),il=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),pi=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_");var gi=e=>{let t,n,r,s,o="",i=e.length%3;for(let c=0;c<e.length;){if((n=e.charCodeAt(c++))>255||(r=e.charCodeAt(c++))>255||(s=e.charCodeAt(c++))>255)throw new TypeError("invalid character found");t=n<<16|r<<8|s,o+=Ee[t>>18&63]+Ee[t>>12&63]+Ee[t>>6&63]+Ee[t&63]}return i?o.slice(0,i-3)+"===".substring(i):o},ns=hi?e=>btoa(e):Hn?e=>Buffer.from(e,"binary").toString("base64"):gi,mi=Hn?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let r=0,s=e.length;r<s;r+=4096)n.push(ct.apply(null,e.subarray(r,r+4096)));return ns(n.join(""))};var yi=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?ct(192|t>>>6)+ct(128|t&63):ct(224|t>>>12&15)+ct(128|t>>>6&63)+ct(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return ct(240|t>>>18&7)+ct(128|t>>>12&63)+ct(128|t>>>6&63)+ct(128|t&63)}},wi=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,bi=e=>e.replace(wi,yi),es=Hn?e=>Buffer.from(e,"utf8").toString("base64"):ts?e=>mi(ts.encode(e)):e=>ns(bi(e)),Gn=(e,t=!1)=>t?pi(es(e)):es(e);var rs=(e,t="_")=>e.replace(/[\W]+/g,t);var ss=e=>JSON.parse(JSON.stringify(e));var xi=()=>String(Math.random())+"-"+Date.now().toFixed();var ve=(e,t)=>new Promise((n,r)=>{if(t&&globalThis[t])return n(globalThis[t]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(e),t&&globalThis[t]?n(globalThis[t]):n(globalThis);let s=document.createElement("script");s.src=e,s.async=!0;let o=()=>{s.removeEventListener("load",i),s.removeEventListener("error",c)},i=()=>{if(o(),!t)return n("loaded: "+e);let a=setInterval(()=>{if(window[t])return clearInterval(a),n(window[t])},5)},c=()=>{o(),r("failed to load: "+e)};s.addEventListener("load",i),s.addEventListener("error",c),document.head.appendChild(s)});var os=e=>{let n=[];for(let r=0;r<e.length;r+=32768)n.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(n.join(""))};var Jn=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0};var Wn=async(e,t)=>new Promise(n=>{let r=xi(),s=o=>{let i=o.data;i.method===t.method&&i.messageId===r&&(e.removeEventListener("message",s),n(i.data))};e.addEventListener("message",s),e.postMessage({...t,messageId:r})});var cs=["jspm","skypack"],as=["unpkg","jsdelivr","fastly.jsdelivr"],ls=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],Ft={getModuleUrl:(e,{isModule:t=!0,defaultCDN:n="jspm"}={})=>{e=e.replace(/#nobundle/g,"");let r=is(e,t,n);return r||(t?"https://jspm.dev/"+e:"https://cdn.jsdelivr.net/npm/"+e)},getUrl:(e,t)=>e.startsWith("http")?e:is(e,!1,t||Si())||e,cdnLists:{npm:as,module:cs,gh:ls},checkCDNs:async(e,t)=>{let n=[t,...Ft.cdnLists.npm].filter(Boolean);for(let r of n)try{if((await fetch(Ft.getUrl(e,r),{method:"HEAD"})).ok)return r}catch{}return Ft.cdnLists.npm[0]}},Si=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||Ft.cdnLists.npm[0]}catch{return Ft.cdnLists.npm[0]}},is=(e,t,n)=>{let r=t&&e.startsWith("unpkg:")?"?module":"";e.startsWith("gh:")?e=e.replace("gh",ls[0]):e.includes(":")||(e=(n||(t?cs[0]:as[0]))+":"+e);for(let s of ki){let[o,i]=s;if(o.test(e))return e.replace(o,i)+r}return null},ki=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://jspm.dev/$2"],[/^(node:)(.+)/i,"https://jspm.dev/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:Kn,getModuleUrl:gl}=Ft;var Zn=Kn("jszip@3.10.1/dist/jszip.js");var ds=Kn("localforage@1.10.0/dist/localforage.js");var Ui="0.6.64",ml=Kn(`malinajs@${Ui}/malina.js`);var nn=()=>{let e=[];return{subscribe:o=>(e.push(o),{unsubscribe:()=>{e.splice(e.indexOf(o),1)}}),notify:o=>{e.forEach(i=>{i(o)})},hasSubscribers:()=>e.length>0,unsubscribeAll:()=>{e.length=0}}};var us={getList:async()=>[],getAllData:async()=>[],getItem:async()=>null,addItem:async()=>"",updateItem:async()=>"",deleteItem:async()=>{},bulkInsert:async()=>{},restore:async()=>{},clear:async()=>{},subscribe:()=>({unsubscribe:()=>{}}),unsubscribeAll:()=>{}},hs={getValue:()=>null,setValue:()=>{},clear:()=>{},subscribe:()=>({unsubscribe:()=>{}}),unsubscribeAll:()=>{}};var rn,fs="livecodes",Yn={},Xn=()=>(Date.now()+""+Math.floor(Math.floor(Math.random()*Date.now()))).substring(0,24),Ei=async e=>{rn||(rn=await ve(ds,"localforage"),rn.config({name:fs})),Yn[e]||(Yn[e]=rn.createInstance({name:fs,storeName:e}))},$t=async(e,t)=>{if(t)return us;let n,r=nn(),s=v=>r.subscribe(v),o=()=>{r.unsubscribeAll()},i=()=>{r.hasSubscribers()&&l().then(v=>{r.notify(v)})},c=async()=>{await Ei(e),n=Yn[e]},a=async()=>(await c(),n.keys()),l=async()=>{await c();let v=[];return await n.iterate(D=>{v.push(D)}),v.sort((D,B)=>B.lastModified&&D.lastModified?B.lastModified-D.lastModified:0)},d=async v=>(await c(),n.getItem(v)),u=async(v,D,B=!0)=>(await c(),await n.setItem(v,D),B&&i(),v),h=async(v,D=!0)=>{let B=Xn();return await u(B,v,D),B};return{getList:a,getAllData:l,getItem:d,addItem:v=>h(v),updateItem:(v,D)=>u(v,D),deleteItem:async v=>{await c(),await n.removeItem(v),i()},bulkInsert:async v=>{for(let D of v)await h(D,!1);i()},restore:async v=>{for(let D of v)D.id?await u(D.id,D,!1):await h(D,!1);i()},clear:async()=>{await c(),await n.clear(),i()},subscribe:s,unsubscribeAll:o}};var Qn=async(e,t)=>{let n=await $t(e,t),r=async()=>(await n.getAllData()).map(c=>({id:c.id,title:c.config?.title||"",description:c.config?.description||"",tags:c.config?.tags||[],languages:c.config?[c.config.markup.language,c.config.style.language,c.config.script.language]:[],lastModified:c.lastModified})).sort((c,a)=>a.lastModified-c.lastModified),s=(c,a)=>{let l={id:c,config:a,lastModified:Date.now()};return n.updateItem(c,l)},o=async c=>{let a=Xn();return s(a,c)};return{...n,getList:r,addItem:o,updateItem:s,bulkInsert:async c=>{for(let a of c)await o(a)}}};var sn=(e,t)=>{if(t)return hs;let n=nn(),r=l=>n.subscribe(l),s=()=>{n.unsubscribeAll()},o=()=>{n.notify(c())},i=l=>{window.localStorage.setItem(e,JSON.stringify(l)),o()},c=()=>{let l=window.localStorage.getItem(e);if(!l)return null;try{return JSON.parse(l)}catch{return null}};return{getValue:c,setValue:i,clear:()=>{i(null),o()},subscribe:r,unsubscribeAll:s}};var ps=()=>ss({projects:null,templates:null,assets:null,snippets:null,recover:null,userConfig:null,userData:null,appData:null,sync:null}),gs=async(e,t)=>{t||(e.projects=await Qn("__livecodes_data__",t),e.templates=await Qn("__livecodes_templates__",t),e.assets=await $t("__livecodes_assets__",t),e.snippets=await $t("__livecodes_snippets__",t),e.recover=sn("__livecodes_project_recover__",t),e.userConfig=sn("__livecodes_user_config__",t),e.userData=await $t("__livecodes_user_data__",t),e.appData=sn("__livecodes_app_data__",t),e.sync=await $t("__livecodes_sync_data__",t))};var tr=(e,t)=>{for(let n of Object.keys(t))if(t[n]===e)return n;return null};var re=(e,t)=>({Accept:`application/vnd.github.v3${t?"."+t:""}+json`,"Content-Type":"application/json",Authorization:"token "+e.token}),vi=async(e,t)=>{try{return(await fetch(`https://api.github.com/repos/${e.username}/${t}`,{method:"GET",cache:"no-store",headers:re(e)})).ok}catch{return!1}},Ci=async(e,t,n=!1,r)=>{let s=await fetch("https://api.github.com/user/repos",{method:"POST",cache:"no-store",headers:re(e),body:JSON.stringify({name:t,private:n,...n?{}:{homepage:`https://${e.username}.github.io/${t}/`},...r?{description:r}:{}})});if(!s.ok)throw await s.json().then(i=>i.errors[0]?.message)==="name already exists on this account"?new Error("Repo name already exists"):new Error("Error creating repo");return s.json().then(o=>o.name)},ms=async({user:e,repo:t,branch:n,file:r,message:s,initialize:o=!1,encoded:i=!1})=>{let c=`https://api.github.com/repos/${e.username}/${t}/contents/`,a=r.path.split("/").slice(0,-1).join("/"),l;if(!o){let u=await fetch(c+a,{method:"GET",cache:"no-store",headers:re(e)});u.ok&&(l=(await u.json()).find(f=>f.path===r.path)?.sha)}let d=await fetch(c+r.path,{method:"PUT",cache:"no-store",headers:re(e),body:JSON.stringify({message:s||"deploy",content:i?r.content:Gn(r.content),branch:n,...l?{sha:l}:{}})});if(!d.ok)throw new Error("Error creating file");return d.json()},Ce=async({user:e,repo:t,branch:n,path:r})=>{let s=`https://api.github.com/repos/${e.username}/${t}/contents/${r}`+(n?`?ref=${n}`:""),o=await fetch(s,{method:"GET",cache:"no-store",headers:re(e,"object")});if(!o.ok)throw new Error("Error getting file");let i=await o.json();if(i.content===""&&i.encoding==="none"){let c=await fetch(s,{method:"GET",cache:"no-store",headers:re(e,"raw")});if(!c.ok)throw new Error("Error getting file");r.endsWith(".b64.zip")?(i.content=await c.arrayBuffer(),i.encoding="arrayBuffer"):(i.content=Gn(await c.text()),i.encoding="base64")}return i},_i=async(e,t,n="main",r)=>(await ms({user:e,repo:t,branch:n,file:{path:"README.md",content:`${r||"# "+t+`
`}`},message:"initial commit",initialize:!0,encoded:!1}))?.commit.sha;var er=async({file:e,user:t,repo:n,branch:r,message:s,newRepo:o,privateRepo:i,description:c,readmeContent:a})=>{try{(o||!await vi(t,n))&&(o=!0,n=rs(n,"-").toLowerCase(),await Ci(t,n,i,c),await _i(t,n,r,a));let l=await ms({user:t,repo:n,branch:r,file:e,message:s,initialize:o||!1,encoded:!0});return{tree:l?.commit?.tree?.sha,commit:l?.commit?.sha}}catch{return null}};var F={};li(F,{AbsolutePosition:()=>Un,AbstractConnector:()=>Er,AbstractStruct:()=>we,AbstractType:()=>L,Array:()=>M,ContentAny:()=>gt,ContentBinary:()=>Bt,ContentDeleted:()=>Mt,ContentEmbed:()=>pt,ContentFormat:()=>O,ContentJSON:()=>ee,ContentString:()=>Z,ContentType:()=>Y,Doc:()=>xt,GC:()=>P,ID:()=>bt,Item:()=>A,Map:()=>z,PermanentUserData:()=>Cr,RelativePosition:()=>ye,Snapshot:()=>Je,Text:()=>Ut,Transaction:()=>vn,UndoManager:()=>Dr,UpdateEncoderV1:()=>St,XmlElement:()=>Nt,XmlFragment:()=>ft,XmlHook:()=>Xt,XmlText:()=>Qt,YArrayEvent:()=>An,YEvent:()=>Yt,YMapEvent:()=>Dn,YTextEvent:()=>Tn,YXmlEvent:()=>In,applyUpdate:()=>jc,applyUpdateV2:()=>On,cleanupYTextFormatting:()=>Ho,compareIDs:()=>Kt,compareRelativePositions:()=>Wc,convertUpdateFormatV1ToV2:()=>ua,convertUpdateFormatV2ToV1:()=>Do,createAbsolutePositionFromRelativePosition:()=>Jc,createDeleteSet:()=>Ln,createDeleteSetFromStructStore:()=>Or,createDocFromSnapshot:()=>ta,createID:()=>k,createRelativePositionFromJSON:()=>Fc,createRelativePositionFromTypeIndex:()=>Pc,createSnapshot:()=>Fr,decodeRelativePosition:()=>Gc,decodeSnapshot:()=>Yc,decodeSnapshotV2:()=>mo,decodeStateVector:()=>Mr,decodeUpdate:()=>ia,decodeUpdateV2:()=>Uo,diffUpdate:()=>da,diffUpdateV2:()=>$r,emptySnapshot:()=>Xc,encodeRelativePosition:()=>zc,encodeSnapshot:()=>Zc,encodeSnapshotV2:()=>go,encodeStateAsUpdate:()=>Oc,encodeStateAsUpdateV2:()=>ho,encodeStateVector:()=>Mc,encodeStateVectorFromUpdate:()=>ca,encodeStateVectorFromUpdateV2:()=>vo,equalSnapshots:()=>Kc,findIndexSS:()=>nt,findRootTypeKey:()=>Rr,getItem:()=>$e,getState:()=>I,getTypeChildren:()=>ga,isDeleted:()=>be,isParentOf:()=>Ge,iterateDeletedStructs:()=>jt,logType:()=>Vc,logUpdate:()=>oa,logUpdateV2:()=>ko,mergeUpdates:()=>Eo,mergeUpdatesV2:()=>Ke,parseUpdateMeta:()=>aa,parseUpdateMetaV2:()=>Co,readUpdate:()=>Ic,readUpdateV2:()=>Br,relativePositionToJSON:()=>Rc,snapshot:()=>Qc,transact:()=>T,tryGc:()=>ra,typeListToArraySnapshot:()=>ma,typeMapGetSnapshot:()=>ba});var H=()=>new Map,_e=e=>{let t=H();return e.forEach((n,r)=>{t.set(r,n)}),t},at=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},ys=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},ws=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var yt=()=>new Set;var on=e=>e[e.length-1];var bs=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},cn=Array.from;var De=Array.isArray;var se=class{constructor(){this._observers=H()}on(t,n){at(this._observers,t,yt).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return cn((this._observers.get(t)||H()).values()).forEach(r=>r(...n))}destroy(){this._observers=H()}};var Q=Math.floor;var oe=Math.abs;var an=(e,t)=>e<t?e:t,wt=(e,t)=>e>t?e:t,Hl=Number.isNaN;var ln=e=>e!==0?e<0:1/e<0;var Ai=String.fromCharCode,Gl=String.fromCodePoint,Jl=Ai(65535),Di=e=>e.toLowerCase(),Ti=/^\s*/g,Ii=e=>e.replace(Ti,""),ji=/([A-Z])/g,sr=(e,t)=>Ii(e.replace(ji,n=>`${t}${Di(n)}`));var Li=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},ce=typeof TextEncoder<"u"?new TextEncoder:null,Oi=e=>ce.encode(e),xs=ce?Oi:Li;var ie=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ie&&ie.decode(new Uint8Array).length===1&&(ie=null);var ir=e=>e===void 0?null:e;var cr=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},Ss=new cr,Bi=!0;try{typeof localStorage<"u"&&(Ss=localStorage,Bi=!1)}catch{}var ks=Ss;var Vi=Object.keys;var Us=e=>Vi(e).length;var Ri=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},Fi=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Es=(e,t)=>e===t||Us(e)===Us(t)&&Ri(e,(n,r)=>(n!==void 0||Fi(t,r))&&t[r]===n);var Te=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Te(e,t,n+1)}};var vs=(e,t)=>t.includes(e);var Ie=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);var Wl=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,lt,Pi=[],qi=()=>{if(lt===void 0)if(Ie){lt=H();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&lt.set(t,""),t=r):t!==null?(lt.set(t,r),t=null):Pi.push(r)}t!==null&&lt.set(t,"")}else typeof location=="object"?(lt=H(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");lt.set(`--${sr(t,"-")}`,n),lt.set(`-${sr(t,"-")}`,n)}})):lt=H();return lt},ar=e=>qi().has(e);var lr=e=>Ie?ir(process.env[e.toUpperCase()]):ir(ks.getItem(e));var zi=e=>ar("--"+e)||lr(e)!==null,Kl=zi("production"),_s=Ie&&vs(process.env.FORCE_COLOR,["true","1","2"]),As=!ar("no-colors")&&(!Ie||process.stdout.isTTY||_s)&&(!Ie||ar("color")||_s||lr("COLORTERM")!==null||(lr("TERM")||"").includes("color"));var dr=Number.MAX_SAFE_INTEGER,Zl=Number.MIN_SAFE_INTEGER,Yl=1<<31;var Ds=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Q(e)===e),Xl=Number.isNaN,Ql=Number.parseInt;var vt=e=>new Error(e),st=()=>{throw vt("Method unimplemented")},W=()=>{throw vt("Unexpected case")};var Ls=vt("Unexpected end of array"),Os=vt("Integer out of Range"),ae=class{constructor(t){this.arr=t,this.pos=0}},R=e=>new ae(e),ur=e=>e.pos!==e.arr.length;var Gi=(e,t)=>{let n=Oe(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},G=e=>Gi(e,E(e));var Pt=e=>e.arr[e.pos++];var E=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&127)*n,n*=128,s<128)return t;if(t>dr)throw Os}throw Ls},Le=e=>{let t=e.arr[e.pos++],n=t&63,r=64,s=(t&64)>0?-1:1;if(!(t&128))return s*n;let o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&127)*r,r*=128,t<128)return s*n;if(n>dr)throw Os}throw Ls};var Ji=e=>{let t=E(e);if(t===0)return"";{let n=String.fromCodePoint(Pt(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Pt(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Wi=e=>ie.decode(G(e)),Ct=ie?Wi:Ji;var hr=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Ki=e=>hr(e,4).getFloat32(0,!1),Zi=e=>hr(e,8).getFloat64(0,!1),Yi=e=>hr(e,8).getBigInt64(0,!1);var Xi=[e=>{},e=>null,Le,Ki,Zi,Yi,e=>!1,e=>!0,Ct,e=>{let t=E(e),n={};for(let r=0;r<t;r++){let s=Ct(e);n[s]=le(e)}return n},e=>{let t=E(e),n=[];for(let r=0;r<t;r++)n.push(le(e));return n},G],le=e=>Xi[127-Pt(e)](e),je=class extends ae{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ur(this)?this.count=E(this)+1:this.count=-1),this.count--,this.s}};var qt=class extends ae{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Le(this);let t=ln(this.s);this.count=1,t&&(this.s=-this.s,this.count=E(this)+2)}return this.count--,this.s}};var de=class extends ae{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=Le(this),n=t&1;this.diff=Q(t/2),this.count=1,n&&(this.count=E(this)+2)}return this.s+=this.diff,this.count--,this.s}},un=class{constructor(t){this.decoder=new qt(t),this.str=Ct(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var tc=e=>new Uint8Array(e),Oe=(e,t,n)=>new Uint8Array(e,t,n);var Ns=e=>{let t=tc(e.byteLength);return t.set(e),t};var zt=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Gt=()=>new zt;var ec=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t};var K=e=>{let t=new Uint8Array(ec(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(Oe(e.cbuf.buffer,0,e.cpos),n),t},nc=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(Oe(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(wt(n,t)*2),e.cpos=0)},N=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var pe=N;var S=(e,t)=>{for(;t>127;)N(e,128|127&t),t=Q(t/128);N(e,127&t)},Be=(e,t)=>{let n=ln(t);for(n&&(t=-t),N(e,(t>63?128:0)|(n?64:0)|63&t),t=Q(t/64);t>0;)N(e,(t>127?128:0)|127&t),t=Q(t/128)},pr=new Uint8Array(3e4),rc=pr.length/3,sc=(e,t)=>{if(t.length<rc){let n=ce.encodeInto(t,pr).written||0;S(e,n);for(let r=0;r<n;r++)N(e,pr[r])}else J(e,xs(t))},oc=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;S(e,r);for(let s=0;s<r;s++)N(e,n.codePointAt(s))},At=ce&&ce.encodeInto?sc:oc;var Rs=(e,t)=>ge(e,K(t)),ge=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=an(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(wt(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},J=(e,t)=>{S(e,t.byteLength),ge(e,t)},gr=(e,t)=>{nc(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},ic=(e,t)=>gr(e,4).setFloat32(0,t,!1),cc=(e,t)=>gr(e,8).setFloat64(0,t,!1),ac=(e,t)=>gr(e,8).setBigInt64(0,t,!1);var Bs=new DataView(new ArrayBuffer(4)),lc=e=>(Bs.setFloat32(0,e),Bs.getFloat32(0)===e),he=(e,t)=>{switch(typeof t){case"string":N(e,119),At(e,t);break;case"number":Ds(t)&&oe(t)<=2147483647?(N(e,125),Be(e,t)):lc(t)?(N(e,124),ic(e,t)):(N(e,123),cc(e,t));break;case"bigint":N(e,122),ac(e,t);break;case"object":if(t===null)N(e,126);else if(De(t)){N(e,117),S(e,t.length);for(let n=0;n<t.length;n++)he(e,t[n])}else if(t instanceof Uint8Array)N(e,116),J(e,t);else{N(e,118);let n=Object.keys(t);S(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];At(e,s),he(e,t[s])}}break;case"boolean":N(e,t?120:121);break;default:N(e,127)}},Ne=class extends zt{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&S(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var Ms=e=>{e.count>0&&(Be(e.encoder,e.count===1?e.s:-e.s),e.count>1&&S(e.encoder,e.count-2))},Ht=class{constructor(){this.encoder=new zt,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ms(this),this.count=1,this.s=t)}toUint8Array(){return Ms(this),K(this.encoder)}};var Vs=e=>{if(e.count>0){let t=e.diff*2+(e.count===1?0:1);Be(e.encoder,t),e.count>1&&S(e.encoder,e.count-2)}},fe=class{constructor(){this.encoder=new zt,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Vs(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Vs(this),K(this.encoder)}},hn=class{constructor(){this.sarr=[],this.s="",this.lensE=new Ht}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new zt;return this.sarr.push(this.s),this.s="",At(t,this.sarr.join("")),ge(t,this.lensE.toUint8Array()),K(t)}};var nd=crypto.subtle,Fs=crypto.getRandomValues.bind(crypto);var mr=()=>Fs(new Uint32Array(1))[0];var uc=[1e7]+-1e3+-4e3+-8e3+-1e11,$s=()=>uc.replace(/[018]/g,e=>(e^mr()&15>>e/4).toString(16));var fn=Date.now;var qs=e=>new Promise(e);var od=Promise.all.bind(Promise);var yr=class{constructor(t,n){this.left=t,this.right=n}},dt=(e,t)=>new yr(e,t);var Jt=typeof document<"u"?document:{};var id=typeof DOMParser<"u"?new DOMParser:null;var zs=e=>ys(e,(t,n)=>`${n}:${t};`).join("");var cd=Jt.ELEMENT_NODE,ad=Jt.TEXT_NODE,ld=Jt.CDATA_SECTION_NODE,dd=Jt.COMMENT_NODE,ud=Jt.DOCUMENT_NODE,hd=Jt.DOCUMENT_TYPE_NODE,fd=Jt.DOCUMENT_FRAGMENT_NODE;var ut=Symbol;var Me=ut(),Ve=ut(),wr=ut(),br=ut(),xr=ut(),Re=ut(),Sr=ut(),Fe=ut(),kr=ut(),Hs=e=>{let t=[],n=[],r=0;for(;r<e.length;r++){let s=e[r];s.constructor===String||s.constructor===Number?t.push(s):s.constructor===Object&&n.push(JSON.stringify(s))}return n};var pd=fn();var wc={[Me]:dt("font-weight","bold"),[Ve]:dt("font-weight","normal"),[wr]:dt("color","blue"),[xr]:dt("color","green"),[br]:dt("color","grey"),[Re]:dt("color","red"),[Sr]:dt("color","purple"),[Fe]:dt("color","orange"),[kr]:dt("color","black")},bc=e=>{let t=[],n=[],r=H(),s=[],o=0;for(;o<e.length;o++){let i=e[o],c=wc[i];if(c!==void 0)r.set(c.left,c.right);else if(i.constructor===String||i.constructor===Number){let a=zs(r);o>0||a.length>0?(t.push("%c"+i),n.push(a)):t.push(i)}else break}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){let i=e[o];i instanceof Symbol||s.push(i)}return s},xc=As?bc:Hs,pn=(...e)=>{console.log(...xc(e)),Sc.forEach(t=>t.print(e))};var Sc=yt();var Gs=e=>({[Symbol.iterator](){return this},next:e}),Js=(e,t)=>Gs(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),gn=(e,t)=>Gs(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var Er=class extends se{constructor(t,n){super(),this.doc=t,this.awareness=n}},qe=class{constructor(t,n){this.clock=t,this.len=n}},It=class{constructor(){this.clients=new Map}},jt=(e,t,n)=>t.clients.forEach((r,s)=>{let o=e.doc.store.clients.get(s);for(let i=0;i<r.length;i++){let c=r[i];wo(e,o,c.clock,c.len,n)}}),Cc=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=Q((n+r)/2),o=e[s],i=o.clock;if(i<=t){if(t<i+o.len)return s;n=s+1}else r=s-1}return null},be=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&Cc(n,t.clock)!==null},Lr=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=wt(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},ze=e=>{let t=new It;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let o=r.slice();for(let i=n+1;i<e.length;i++)bs(o,e[i].clients.get(s)||[]);t.clients.set(s,o)}});return Lr(t),t},He=(e,t,n,r)=>{at(e.clients,t,()=>[]).push(new qe(n,r))},Ln=()=>new It,Or=e=>{let t=Ln();return e.clients.forEach((n,r)=>{let s=[];for(let o=0;o<n.length;o++){let i=n[o];if(i.deleted){let c=i.id.clock,a=i.length;if(o+1<n.length)for(let l=n[o+1];o+1<n.length&&l.deleted;l=n[++o+1])a+=l.length;s.push(new qe(c,a))}}s.length>0&&t.clients.set(r,s)}),t},ht=(e,t)=>{S(e.restEncoder,t.clients.size),t.clients.forEach((n,r)=>{e.resetDsCurVal(),S(e.restEncoder,r);let s=n.length;S(e.restEncoder,s);for(let o=0;o<s;o++){let i=n[o];e.writeDsClock(i.clock),e.writeDsLen(i.len)}})},Lt=e=>{let t=new It,n=E(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=E(e.restDecoder),o=E(e.restDecoder);if(o>0){let i=at(t.clients,s,()=>[]);for(let c=0;c<o;c++)i.push(new qe(e.readDsClock(),e.readDsLen()))}}return t},Zs=(e,t,n)=>{let r=new It,s=E(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();let i=E(e.restDecoder),c=E(e.restDecoder),a=n.clients.get(i)||[],l=I(n,i);for(let d=0;d<c;d++){let u=e.readDsClock(),h=u+e.readDsLen();if(u<l){l<h&&He(r,i,l,h-l);let f=nt(a,u),y=a[f];for(!y.deleted&&y.id.clock<u&&(a.splice(f+1,0,jn(t,y,u-y.id.clock)),f++);f<a.length&&(y=a[f++],y.id.clock<h);)y.deleted||(h<y.id.clock+y.length&&a.splice(f,0,jn(t,y,h-y.id.clock)),y.delete(t))}else He(r,i,u,h-u)}}if(r.clients.size>0){let o=new it;return S(o.restEncoder,0),ht(o,r),o.toUint8Array()}return null},uo=mr,xt=class extends se{constructor({guid:t=$s(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=uo(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new En,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.whenLoaded=qs(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})})}load(){let t=this._item;t!==null&&!this.shouldLoad&&T(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){T(this,t,n)}get(t,n=L){let r=at(this.share,t,()=>{let o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==L&&s!==n)if(s===L){let o=new n;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,M)}getText(t=""){return this.get(t,Ut)}getMap(t=""){return this.get(t,z)}getXmlFragment(t=""){return this.get(t,ft)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){cn(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new xt({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,T(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}},Zt=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return E(this.restDecoder)}readDsLen(){return E(this.restDecoder)}},ot=class extends Zt{readLeftID(){return k(E(this.restDecoder),E(this.restDecoder))}readRightID(){return k(E(this.restDecoder),E(this.restDecoder))}readClient(){return E(this.restDecoder)}readInfo(){return Pt(this.restDecoder)}readString(){return Ct(this.restDecoder)}readParentInfo(){return E(this.restDecoder)===1}readTypeRef(){return E(this.restDecoder)}readLen(){return E(this.restDecoder)}readAny(){return le(this.restDecoder)}readBuf(){return Ns(G(this.restDecoder))}readJSON(){return JSON.parse(Ct(this.restDecoder))}readKey(){return Ct(this.restDecoder)}},kn=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=E(this.restDecoder),this.dsCurrVal}readDsLen(){let t=E(this.restDecoder)+1;return this.dsCurrVal+=t,t}},et=class extends kn{constructor(t){super(t),this.keys=[],E(t),this.keyClockDecoder=new de(G(t)),this.clientDecoder=new qt(G(t)),this.leftClockDecoder=new de(G(t)),this.rightClockDecoder=new de(G(t)),this.infoDecoder=new je(G(t),Pt),this.stringDecoder=new un(G(t)),this.parentInfoDecoder=new je(G(t),Pt),this.typeRefDecoder=new qt(G(t)),this.lenDecoder=new qt(G(t))}readLeftID(){return new bt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new bt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return le(this.restDecoder)}readBuf(){return G(this.restDecoder)}readJSON(){return le(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},Ot=class{constructor(){this.restEncoder=Gt()}toUint8Array(){return K(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){S(this.restEncoder,t)}writeDsLen(t){S(this.restEncoder,t)}},St=class extends Ot{writeLeftID(t){S(this.restEncoder,t.client),S(this.restEncoder,t.clock)}writeRightID(t){S(this.restEncoder,t.client),S(this.restEncoder,t.clock)}writeClient(t){S(this.restEncoder,t)}writeInfo(t){pe(this.restEncoder,t)}writeString(t){At(this.restEncoder,t)}writeParentInfo(t){S(this.restEncoder,t?1:0)}writeTypeRef(t){S(this.restEncoder,t)}writeLen(t){S(this.restEncoder,t)}writeAny(t){he(this.restEncoder,t)}writeBuf(t){J(this.restEncoder,t)}writeJSON(t){At(this.restEncoder,JSON.stringify(t))}writeKey(t){At(this.restEncoder,t)}},me=class{constructor(){this.restEncoder=Gt(),this.dsCurrVal=0}toUint8Array(){return K(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,S(this.restEncoder,n)}writeDsLen(t){t===0&&W(),S(this.restEncoder,t-1),this.dsCurrVal+=t}},it=class extends me{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new fe,this.clientEncoder=new Ht,this.leftClockEncoder=new fe,this.rightClockEncoder=new fe,this.infoEncoder=new Ne(pe),this.stringEncoder=new hn,this.parentInfoEncoder=new Ne(pe),this.typeRefEncoder=new Ht,this.lenEncoder=new Ht}toUint8Array(){let t=Gt();return S(t,0),J(t,this.keyClockEncoder.toUint8Array()),J(t,this.clientEncoder.toUint8Array()),J(t,this.leftClockEncoder.toUint8Array()),J(t,this.rightClockEncoder.toUint8Array()),J(t,K(this.infoEncoder)),J(t,this.stringEncoder.toUint8Array()),J(t,K(this.parentInfoEncoder)),J(t,this.typeRefEncoder.toUint8Array()),J(t,this.lenEncoder.toUint8Array()),ge(t,K(this.restEncoder)),K(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){he(this.restEncoder,t)}writeBuf(t){J(this.restEncoder,t)}writeJSON(t){he(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},_c=(e,t,n,r)=>{r=wt(r,t[0].id.clock);let s=nt(t,r);S(e.restEncoder,t.length-s),e.writeClient(n),S(e.restEncoder,r);let o=t[s];o.write(e,r-o.id.clock);for(let i=s+1;i<t.length;i++)t[i].write(e,0)},Nr=(e,t,n)=>{let r=new Map;n.forEach((s,o)=>{I(t,o)>s&&r.set(o,s)}),Qe(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),S(e.restEncoder,r.size),Array.from(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{_c(e,t.clients.get(s),s,o)})},Ac=(e,t)=>{let n=H(),r=E(e.restDecoder);for(let s=0;s<r;s++){let o=E(e.restDecoder),i=new Array(o),c=e.readClient(),a=E(e.restDecoder);n.set(c,{i:0,refs:i});for(let l=0;l<o;l++){let d=e.readInfo();switch(31&d){case 0:{let u=e.readLen();i[l]=new P(k(c,a),u),a+=u;break}case 10:{let u=E(e.restDecoder);i[l]=new q(k(c,a),u),a+=u;break}default:{let u=(d&192)===0,h=new A(k(c,a),null,(d&128)===128?e.readLeftID():null,null,(d&64)===64?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(d&32)===32?e.readString():null,Wo(e,d));i[l]=h,a+=h.length}}}}return n},Dc=(e,t,n)=>{let r=[],s=Array.from(n.keys()).sort((f,y)=>f-y);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f},i=o();if(i===null&&r.length===0)return null;let c=new En,a=new Map,l=(f,y)=>{let x=a.get(f);(x==null||x>y)&&a.set(f,y)},d=i.refs[i.i++],u=new Map,h=()=>{for(let f of r){let y=f.id.client,x=n.get(y);x?(x.i--,c.clients.set(y,x.refs.slice(x.i)),n.delete(y),x.i=0,x.refs=[]):c.clients.set(y,[f]),s=s.filter(U=>U!==y)}r.length=0};for(;;){if(d.constructor!==q){let y=at(u,d.id.client,()=>I(t,d.id.client))-d.id.clock;if(y<0)r.push(d),l(d.id.client,d.id.clock-1),h();else{let x=d.getMissing(e,t);if(x!==null){r.push(d);let U=n.get(x)||{refs:[],i:0};if(U.refs.length===U.i)l(x,I(t,x)),h();else{d=U.refs[U.i++];continue}}else(y===0||y<d.length)&&(d.integrate(e,y),u.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(i!==null&&i.i<i.refs.length)d=i.refs[i.i++];else{if(i=o(),i===null)break;d=i.refs[i.i++]}}if(c.clients.size>0){let f=new it;return Nr(f,c,new Map),S(f.restEncoder,0),{missing:a,update:f.toUint8Array()}}return null},Tc=(e,t)=>Nr(e,t.doc.store,t.beforeState),Br=(e,t,n,r=new et(e))=>T(t,s=>{s.local=!1;let o=!1,i=s.doc,c=i.store,a=Ac(r,i),l=Dc(s,c,a),d=c.pendingStructs;if(d){for(let[h,f]of d.missing)if(f<I(c,h)){o=!0;break}if(l){for(let[h,f]of l.missing){let y=d.missing.get(h);(y==null||y>f)&&d.missing.set(h,f)}d.update=Ke([d.update,l.update])}}else c.pendingStructs=l;let u=Zs(r,s,c);if(c.pendingDs){let h=new et(R(c.pendingDs));E(h.restDecoder);let f=Zs(h,s,c);u&&f?c.pendingDs=Ke([u,f]):c.pendingDs=u||f}else c.pendingDs=u;if(o){let h=c.pendingStructs.update;c.pendingStructs=null,On(s.doc,h)}},n,!1),Ic=(e,t,n)=>Br(e,t,n,new ot(e)),On=(e,t,n,r=et)=>{let s=R(t);Br(s,e,n,new r(s))},jc=(e,t,n)=>On(e,t,n,ot),Lc=(e,t,n=new Map)=>{Nr(e,t.store,n),ht(e,Or(t.store))},ho=(e,t=new Uint8Array([0]),n=new it)=>{let r=Mr(t);Lc(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push($r(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===St)return Eo(s.map((o,i)=>i===0?o:Do(o)));if(n.constructor===it)return Ke(s)}return s[0]},Oc=(e,t)=>ho(e,t,new St),fo=e=>{let t=new Map,n=E(e.restDecoder);for(let r=0;r<n;r++){let s=E(e.restDecoder),o=E(e.restDecoder);t.set(s,o)}return t},Mr=e=>fo(new Zt(R(e))),Vr=(e,t)=>(S(e.restEncoder,t.size),Array.from(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{S(e.restEncoder,n),S(e.restEncoder,r)}),e),Nc=(e,t)=>Vr(e,Qe(t.store)),Bc=(e,t=new me)=>(e instanceof Map?Vr(t,e):Nc(t,e),t.toUint8Array()),Mc=e=>Bc(e,new Ot),vr=class{constructor(){this.l=[]}},Ys=()=>new vr,Xs=(e,t)=>e.l.push(t),Qs=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},po=(e,t,n)=>Te(e.l,[t,n]),bt=class{constructor(t,n){this.client=t,this.clock=n}},Kt=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,k=(e,t)=>new bt(e,t),to=(e,t)=>{S(e,t.client),S(e,t.clock)},eo=e=>k(E(e),E(e)),Rr=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw W()},Ge=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Vc=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},Cr=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(o,i)=>{let c=o.get("ds"),a=o.get("ids"),l=d=>this.clients.set(d,i);c.observe(d=>{d.changes.added.forEach(u=>{u.content.getContent().forEach(h=>{h instanceof Uint8Array&&this.dss.set(i,ze([this.dss.get(i)||Ln(),Lt(new Zt(R(h)))]))})})}),this.dss.set(i,ze(c.map(d=>Lt(new Zt(R(d)))))),a.observe(d=>d.changes.added.forEach(u=>u.content.getContent().forEach(l))),a.forEach(l)};n.observe(o=>{o.keysChanged.forEach(i=>s(n.get(i),i))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let o=this.yusers,i=o.get(r);i||(i=new z,i.set("ids",new M),i.set("ds",new M),o.set(r,i)),i.get("ids").push([n]),o.observe(c=>{setTimeout(()=>{let a=o.get(r);if(a!==i){i=a,this.clients.forEach((u,h)=>{r===u&&i.get("ids").push([h])});let l=new Ot,d=this.dss.get(r);d&&(ht(l,d),i.get("ds").push([l.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{let a=i.get("ds"),l=c.deleteSet;if(c.local&&l.clients.size>0&&s(c,l)){let d=new Ot;ht(d,l),a.push([d.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(be(r,t))return n;return null}},ye=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},Rc=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},Fc=e=>new ye(e.type==null?null:k(e.type.client,e.type.clock),e.tname||null,e.item==null?null:k(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),Un=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},$c=(e,t,n=0)=>new Un(e,t,n),mn=(e,t,n)=>{let r=null,s=null;return e._item===null?s=Rr(e):r=k(e._item.id.client,e._item.id.clock),new ye(r,s,t,n)},Pc=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return mn(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return mn(e,k(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return mn(e,r.lastId,n);r=r.right}return mn(e,null,n)},qc=(e,t)=>{let{type:n,tname:r,item:s,assoc:o}=t;if(s!==null)S(e,0),to(e,s);else if(r!==null)pe(e,1),At(e,r);else if(n!==null)pe(e,2),to(e,n);else throw W();return Be(e,o),e},zc=e=>{let t=Gt();return qc(t,e),K(t)},Hc=e=>{let t=null,n=null,r=null;switch(E(e)){case 0:r=eo(e);break;case 1:n=Ct(e);break;case 2:t=eo(e)}let s=ur(e)?Le(e):0;return new ye(t,n,r,s)},Gc=e=>Hc(R(e)),Jc=(e,t)=>{let n=t.store,r=e.item,s=e.type,o=e.tname,i=e.assoc,c=null,a=0;if(r!==null){if(I(n,r.client)<=r.clock)return null;let l=Ir(n,r),d=l.item;if(!(d instanceof A))return null;if(c=d.parent,c._item===null||!c._item.deleted){a=d.deleted||!d.countable?0:l.diff+(i>=0?0:1);let u=d.left;for(;u!==null;)!u.deleted&&u.countable&&(a+=u.length),u=u.left}}else{if(o!==null)c=t.get(o);else if(s!==null){if(I(n,s.client)<=s.clock)return null;let{item:l}=Ir(n,s);if(l instanceof A&&l.content instanceof Y)c=l.content.type;else return null}else throw W();i>=0?a=c._length:a=0}return $c(c,a,e.assoc)},Wc=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Kt(e.item,t.item)&&Kt(e.type,t.type)&&e.assoc===t.assoc,Je=class{constructor(t,n){this.ds=t,this.sv=n}},Kc=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,o=t.sv;if(s.size!==o.size||n.size!==r.size)return!1;for(let[i,c]of s.entries())if(o.get(i)!==c)return!1;for(let[i,c]of n.entries()){let a=r.get(i)||[];if(c.length!==a.length)return!1;for(let l=0;l<c.length;l++){let d=c[l],u=a[l];if(d.clock!==u.clock||d.len!==u.len)return!1}}return!0},go=(e,t=new me)=>(ht(t,e.ds),Vr(t,e.sv),t.toUint8Array()),Zc=e=>go(e,new Ot),mo=(e,t=new kn(R(e)))=>new Je(Lt(t),fo(t)),Yc=e=>mo(e,new Zt(R(e))),Fr=(e,t)=>new Je(e,t),Xc=Fr(Ln(),new Map),Qc=e=>Fr(Or(e.store),Qe(e.store)),Wt=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!be(t.ds,e.id),bn=(e,t)=>{let n=at(e.meta,bn,yt),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<I(r,o)&&$(e,k(o,s))}),jt(e,t.ds,s=>{}),n.add(t))},ta=(e,t,n=new xt)=>{if(e.gc)throw new Error("originDoc must not be garbage collected");let{sv:r,ds:s}=t,o=new it;return e.transact(i=>{let c=0;r.forEach(a=>{a>0&&c++}),S(o.restEncoder,c);for(let[a,l]of r){if(l===0)continue;l<I(e.store,a)&&$(i,k(a,l));let d=e.store.clients.get(a)||[],u=nt(d,l-1);S(o.restEncoder,u+1),o.writeClient(a),S(o.restEncoder,0);for(let h=0;h<=u;h++)d[h].write(o,0)}ht(o,s)}),On(n,o.toUint8Array(),"snapshot"),n},En=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},Qe=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},I=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},yo=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw W()}n.push(t)},nt=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let i=Q(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[i],o=s.id.clock,o<=t){if(t<o+s.length)return i;n=i+1}else r=i-1;i=Q((n+r)/2)}throw W()},ea=(e,t)=>{let n=e.clients.get(t.client);return n[nt(n,t.clock)]},$e=ea,_r=(e,t,n)=>{let r=nt(t,n),s=t[r];return s.id.clock<n&&s instanceof A?(t.splice(r+1,0,jn(e,s,n-s.id.clock)),r+1):r},$=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[_r(e,n,t.clock)]},no=(e,t,n)=>{let r=t.clients.get(n.client),s=nt(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==P&&r.splice(s+1,0,jn(e,o,n.clock-o.id.clock+1)),o},na=(e,t,n)=>{let r=e.clients.get(t.id.client);r[nt(r,t.id.clock)]=n},wo=(e,t,n,r,s)=>{if(r===0)return;let o=n+r,i=_r(e,t,n),c;do c=t[i++],o<c.id.clock+c.length&&_r(e,t,o),s(c);while(i<t.length&&t[i].id.clock<o)},vn=class{constructor(t,n,r){this.doc=t,this.deleteSet=new It,this.beforeState=Qe(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}},ro=(e,t)=>t.deleteSet.clients.size===0&&!ws(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Lr(t.deleteSet),Tc(e,t),ht(e,t.deleteSet),!0),so=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&at(e.changed,t,yt).add(n)},xn=(e,t)=>{let n=e[t-1],r=e[t];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(e.splice(t,1),r instanceof A&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},bo=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let o=t.clients.get(r);for(let i=s.length-1;i>=0;i--){let c=s[i],a=c.clock+c.len;for(let l=nt(o,c.clock),d=o[l];l<o.length&&d.id.clock<a;d=o[++l]){let u=o[l];if(c.clock+c.len<=u.id.clock)break;u instanceof A&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},xo=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){let i=n[o],c=an(s.length-1,1+nt(s,i.clock+i.len-1));for(let a=c,l=s[a];a>0&&l.id.clock>=i.clock;l=s[--a])xn(s,a)}})},ra=(e,t,n)=>{bo(e,t,n),xo(e,t)},So=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,o=n.deleteSet,i=n._mergeStructs;try{Lr(o),n.afterState=Qe(n.doc.store),r._transaction=null,r.emit("beforeObserverCalls",[n,r]);let c=[];n.changed.forEach((a,l)=>c.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,a)})),c.push(()=>{n.changedParentTypes.forEach((a,l)=>c.push(()=>{(l._item===null||!l._item.deleted)&&(a=a.filter(d=>d.target._item===null||!d.target._item.deleted),a.forEach(d=>{d.currentTarget=l}),a.sort((d,u)=>d.path.length-u.path.length),po(l._dEH,a,n))})),c.push(()=>r.emit("afterTransaction",[n,r]))}),Te(c,[])}finally{r.gc&&bo(o,s,r.gcFilter),xo(o,s),n.afterState.forEach((d,u)=>{let h=n.beforeState.get(u)||0;if(h!==d){let f=s.clients.get(u),y=wt(nt(f,h),1);for(let x=f.length-1;x>=y;x--)xn(f,x)}});for(let d=0;d<i.length;d++){let{client:u,clock:h}=i[d].id,f=s.clients.get(u),y=nt(f,h);y+1<f.length&&xn(f,y+1),y>0&&xn(f,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(pn(Fe,Me,"[yjs] ",Ve,Re,"Changed the client-id because another client seems to be using it."),r.clientID=uo()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let d=new St;ro(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let d=new it;ro(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}let{subdocsAdded:c,subdocsLoaded:a,subdocsRemoved:l}=n;(c.size>0||l.size>0||a.size>0)&&(c.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),l.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:a,added:c,removed:l},r,n]),l.forEach(d=>d.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):So(e,t+1)}}},T=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,o=!1;e._transaction===null&&(o=!0,e._transaction=new vn(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{o&&s[0]===e._transaction&&So(s,0)}},Ar=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},oo=(e,t,n)=>{jt(e,n.deletions,r=>{r instanceof A&&t.scope.some(s=>Ge(s,r))&&Gr(r,!1)})},io=(e,t,n)=>{let r=null,s=null,o=e.doc,i=e.scope;if(T(o,c=>{for(;t.length>0&&r===null;){let a=o.store,l=t.pop(),d=new Set,u=[],h=!1;jt(c,l.insertions,f=>{if(f instanceof A){if(f.redone!==null){let{item:y,diff:x}=Ir(a,f.id);x>0&&(y=$(c,k(y.id.client,y.id.clock+x))),f=y}!f.deleted&&i.some(y=>Ge(y,f))&&u.push(f)}}),jt(c,l.deletions,f=>{f instanceof A&&i.some(y=>Ge(y,f))&&!be(l.insertions,f.id)&&d.add(f)}),d.forEach(f=>{h=Jo(c,f,d,l.insertions,e.ignoreRemoteMapChanges)!==null||h});for(let f=u.length-1;f>=0;f--){let y=u[f];e.deleteFilter(y)&&(y.delete(c),h=!0)}r=h?l:null}c.changed.forEach((a,l)=>{a.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),s=c},e),r!=null){let c=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:c},e])}return r},Dr=class extends se{constructor(t,{captureTimeout:n=500,captureTransaction:r=a=>!0,deleteFilter:s=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:c=De(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=s,o.add(this),this.trackedOrigins=o,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=c,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(U=>a.changedParentTypes.has(U))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;let l=this.undoing,d=this.redoing,u=l?this.redoStack:this.undoStack;l?this.stopCapturing():d||this.clear(!1,!0);let h=new It;a.afterState.forEach((U,v)=>{let D=a.beforeState.get(v)||0,B=U-D;B>0&&He(h,v,D,B)});let f=fn(),y=!1;if(f-this.lastChange<n&&u.length>0&&!l&&!d){let U=u[u.length-1];U.deletions=ze([U.deletions,a.deleteSet]),U.insertions=ze([U.insertions,h])}else u.push(new Ar(a.deleteSet,h)),y=!0;!l&&!d&&(this.lastChange=f),jt(a,a.deleteSet,U=>{U instanceof A&&this.scope.some(v=>Ge(v,U))&&Gr(U,!0)});let x=[{stackItem:u[u.length-1],origin:a.origin,type:l?"redo":"undo",changedParentTypes:a.changedParentTypes},this];y?this.emit("stack-item-added",x):this.emit("stack-item-updated",x)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=De(t)?t:[t],t.forEach(n=>{this.scope.every(r=>r!==n)&&this.scope.push(n)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>oo(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>oo(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=io(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=io(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*sa(e){let t=E(e.restDecoder);for(let n=0;n<t;n++){let r=E(e.restDecoder),s=e.readClient(),o=E(e.restDecoder);for(let i=0;i<r;i++){let c=e.readInfo();if(c===10){let a=E(e.restDecoder);yield new q(k(s,o),a),o+=a}else if(31&c){let a=(c&192)===0,l=new A(k(s,o),null,(c&128)===128?e.readLeftID():null,null,(c&64)===64?e.readRightID():null,a?e.readParentInfo()?e.readString():e.readLeftID():null,a&&(c&32)===32?e.readString():null,Wo(e,c));yield l,o+=l.length}else{let a=e.readLen();yield new P(k(s,o),a),o+=a}}}}var kt=class{constructor(t,n){this.gen=sa(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===q);return this.curr}},oa=e=>ko(e,ot),ko=(e,t=et)=>{let n=[],r=new t(R(e)),s=new kt(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);pn("Structs: ",n);let o=Lt(r);pn("DeleteSet: ",o)},ia=e=>Uo(e,ot),Uo=(e,t=et)=>{let n=[],r=new t(R(e)),s=new kt(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);return{structs:n,ds:Lt(r)}},We=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},Eo=e=>Ke(e,ot,St),vo=(e,t=me,n=et)=>{let r=new t,s=new kt(new n(R(e)),!1),o=s.curr;if(o!==null){let i=0,c=o.id.client,a=o.id.clock!==0,l=a?0:o.id.clock+o.length;for(;o!==null;o=s.next())c!==o.id.client&&(l!==0&&(i++,S(r.restEncoder,c),S(r.restEncoder,l)),c=o.id.client,l=0,a=o.id.clock!==0),o.constructor===q&&(a=!0),a||(l=o.id.clock+o.length);l!==0&&(i++,S(r.restEncoder,c),S(r.restEncoder,l));let d=Gt();return S(d,i),Rs(d,r.restEncoder),r.restEncoder=d,r.toUint8Array()}else return S(r.restEncoder,0),r.toUint8Array()},ca=e=>vo(e,Ot,ot),Co=(e,t=et)=>{let n=new Map,r=new Map,s=new kt(new t(R(e)),!1),o=s.curr;if(o!==null){let i=o.id.client,c=o.id.clock;for(n.set(i,c);o!==null;o=s.next())i!==o.id.client&&(r.set(i,c),n.set(o.id.client,o.id.clock),i=o.id.client),c=o.id.clock+o.length;r.set(i,c)}return{from:n,to:r}},aa=e=>Co(e,ot),la=(e,t)=>{if(e.constructor===P){let{client:n,clock:r}=e.id;return new P(k(n,r+t),e.length-t)}else if(e.constructor===q){let{client:n,clock:r}=e.id;return new q(k(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new A(k(r,s+t),null,k(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ke=(e,t=et,n=it)=>{if(e.length===1)return e[0];let r=e.map(d=>new t(R(d))),s=r.map(d=>new kt(d,!0)),o=null,i=new n,c=new We(i);for(;s=s.filter(h=>h.curr!==null),s.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){let y=h.curr.id.clock-f.curr.id.clock;return y===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===q?1:-1:y}else return f.curr.id.client-h.curr.id.client}),s.length!==0;){let d=s[0],u=d.curr.id.client;if(o!==null){let h=d.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=o.struct.id.clock+o.struct.length&&h.id.client>=o.struct.id.client;)h=d.next(),f=!0;if(h===null||h.id.client!==u||f&&h.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)Dt(c,o.struct,o.offset),o={struct:h,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<h.id.clock)if(o.struct.constructor===q)o.struct.length=h.id.clock+h.length-o.struct.id.clock;else{Dt(c,o.struct,o.offset);let y=h.id.clock-o.struct.id.clock-o.struct.length;o={struct:new q(k(u,o.struct.id.clock+o.struct.length),y),offset:0}}else{let y=o.struct.id.clock+o.struct.length-h.id.clock;y>0&&(o.struct.constructor===q?o.struct.length-=y:h=la(h,y)),o.struct.mergeWith(h)||(Dt(c,o.struct,o.offset),o={struct:h,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let h=d.curr;h!==null&&h.id.client===u&&h.id.clock===o.struct.id.clock+o.struct.length&&h.constructor!==q;h=d.next())Dt(c,o.struct,o.offset),o={struct:h,offset:0}}o!==null&&(Dt(c,o.struct,o.offset),o=null),Pr(c);let a=r.map(d=>Lt(d)),l=ze(a);return ht(i,l),i.toUint8Array()},$r=(e,t,n=et,r=it)=>{let s=Mr(t),o=new r,i=new We(o),c=new n(R(e)),a=new kt(c,!1);for(;a.curr;){let d=a.curr,u=d.id.client,h=s.get(u)||0;if(a.curr.constructor===q){a.next();continue}if(d.id.clock+d.length>h)for(Dt(i,d,wt(h-d.id.clock,0)),a.next();a.curr&&a.curr.id.client===u;)Dt(i,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===u&&a.curr.id.clock+a.curr.length<=h;)a.next()}Pr(i);let l=Lt(c);return ht(o,l),o.toUint8Array()},da=(e,t)=>$r(e,t,ot,St),_o=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:K(e.encoder.restEncoder)}),e.encoder.restEncoder=Gt(),e.written=0)},Dt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&_o(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),S(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Pr=e=>{_o(e);let t=e.encoder.restEncoder;S(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];S(t,r.written),ge(t,r.restEncoder)}},Ao=(e,t,n)=>{let r=new t(R(e)),s=new kt(r,!1),o=new n,i=new We(o);for(let a=s.curr;a!==null;a=s.next())Dt(i,a,0);Pr(i);let c=Lt(r);return ht(o,c),o.toUint8Array()},ua=e=>Ao(e,ot,it),Do=e=>Ao(e,et,St),Yt=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return ha(this.currentTarget,this.target)}deletes(t){return be(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let o=n._map.get(s),i,c;if(this.adds(o)){let a=o.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(o))if(a!==null&&this.deletes(a))i="delete",c=on(a.content.getContent());else return;else a!==null&&this.deletes(a)?(i="update",c=on(a.content.getContent())):(i="add",c=void 0)}else if(this.deletes(o))i="delete",c=on(o.content.getContent());else return;t.set(s,{action:i,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){let n=this.target,r=yt(),s=yt(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null,a=()=>{c&&o.push(c)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((c===null||c.delete===void 0)&&(a(),c={delete:0}),c.delete+=l.length,s.add(l)):this.adds(l)?((c===null||c.insert===void 0)&&(a(),c={insert:[]}),c.insert=c.insert.concat(l.content.getContent()),r.add(l)):((c===null||c.retain===void 0)&&(a(),c={retain:0}),c.retain+=l.length);c!==null&&c.retain===void 0&&a()}this._changes=t}return t}},ha=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},To=80,qr=0,Tr=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=qr++}},fa=e=>{e.timestamp=qr++},Io=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=qr++},pa=(e,t,n)=>{if(e.length>=To){let r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return Io(r,t,n),r}else{let r=new Tr(t,n);return e.push(r),r}},Nn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,i)=>oe(t-o.index)<oe(t-i.index)?o:i),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,fa(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&oe(n.index-s)<r.parent.length/To?(Io(n,r,s),n):pa(e._searchMarker,r,s)},Ze=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=wt(t,s.index+n))}},ga=e=>{let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},Bn=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;at(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;po(r._eH,n,t)},L=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ys(),this._dEH=Ys(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw st()}clone(){throw st()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Xs(this._eH,t)}observeDeep(t){Xs(this._dEH,t)}unobserve(t){Qs(this._eH,t)}unobserveDeep(t){Qs(this._dEH,t)}toJSON(){}},jo=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let i=o.content.getContent();if(i.length<=t)t-=i.length;else{for(let c=t;c<i.length&&r>0;c++)s.push(i[c]),r--;t=0}}o=o.right}return s},Lo=e=>{let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},ma=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&Wt(r,t)){let s=r.content.getContent();for(let o=0;o<s.length;o++)n.push(s[o])}r=r.right}return n},Ye=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}r=r.right}},Oo=(e,t)=>{let n=[];return Ye(e,(r,s)=>{n.push(t(r,s,e))}),n},ya=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},No=(e,t)=>{let n=Nn(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Cn=(e,t,n,r)=>{let s=n,o=e.doc,i=o.clientID,c=o.store,a=n===null?t._start:n.right,l=[],d=()=>{l.length>0&&(s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new gt(l)),s.integrate(e,0),l=[])};r.forEach(u=>{if(u===null)l.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(u);break;default:switch(d(),u.constructor){case Uint8Array:case ArrayBuffer:s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new Bt(new Uint8Array(u))),s.integrate(e,0);break;case xt:s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new te(u)),s.integrate(e,0);break;default:if(u instanceof L)s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new Y(u)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},Bo=vt("Length exceeded!"),Mo=(e,t,n,r)=>{if(n>t._length)throw Bo;if(n===0)return t._searchMarker&&Ze(t._searchMarker,n,r.length),Cn(e,t,null,r);let s=n,o=Nn(t,n),i=t._start;for(o!==null&&(i=o.p,n-=o.index,n===0&&(i=i.prev,n+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(n<=i.length){n<i.length&&$(e,k(i.id.client,i.id.clock+n));break}n-=i.length}return t._searchMarker&&Ze(t._searchMarker,s,r.length),Cn(e,t,i,r)},wa=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Cn(e,t,s,n)},Vo=(e,t,n,r)=>{if(r===0)return;let s=n,o=r,i=Nn(t,n),c=t._start;for(i!==null&&(c=i.p,n-=i.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&$(e,k(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&$(e,k(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw Bo;t._searchMarker&&Ze(t._searchMarker,s,-o+r)},_n=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},zr=(e,t,n,r)=>{let s=t._map.get(n)||null,o=e.doc,i=o.clientID,c;if(r==null)c=new gt([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new gt([r]);break;case Uint8Array:c=new Bt(r);break;case xt:c=new te(r);break;default:if(r instanceof L)c=new Y(r);else throw new Error("Unexpected content type")}new A(k(i,I(o.store,i)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},Hr=(e,t)=>{let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ro=e=>{let t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Fo=(e,t)=>{let n=e._map.get(t);return n!==void 0&&!n.deleted},ba=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&Wt(r,n)?r.content.getContent()[r.length-1]:void 0},yn=e=>Js(e.entries(),t=>!t[1].deleted),An=class extends Yt{constructor(t,n){super(t,n),this._transaction=n}},M=class extends L{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new M;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new M}clone(){let t=new M;return t.insert(0,this.toArray().map(n=>n instanceof L?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Bn(this,t,new An(this,t))}insert(t,n){this.doc!==null?T(this.doc,r=>{Mo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?T(this.doc,n=>{wa(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?T(this.doc,r=>{Vo(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return No(this,t)}toArray(){return Lo(this)}slice(t=0,n=this.length){return jo(this,t,n)}toJSON(){return this.map(t=>t instanceof L?t.toJSON():t)}map(t){return Oo(this,t)}forEach(t){Ye(this,t)}[Symbol.iterator](){return ya(this)}_write(t){t.writeTypeRef(Va)}},xa=e=>new M,Dn=class extends Yt{constructor(t,n,r){super(t,n),this.keysChanged=r}},z=class extends L{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new z}clone(){let t=new z;return this.forEach((n,r)=>{t.set(r,n instanceof L?n.clone():n)}),t}_callObserver(t,n){Bn(this,t,new Dn(this,t,n))}toJSON(){let t={};return this._map.forEach((n,r)=>{if(!n.deleted){let s=n.content.getContent()[n.length-1];t[r]=s instanceof L?s.toJSON():s}}),t}get size(){return[...yn(this._map)].length}keys(){return gn(yn(this._map),t=>t[0])}values(){return gn(yn(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return gn(yn(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){let n={};return this._map.forEach((r,s)=>{r.deleted||t(r.content.getContent()[r.length-1],s,this)}),n}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?T(this.doc,n=>{_n(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?T(this.doc,r=>{zr(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Hr(this,t)}has(t){return Fo(this,t)}clear(){this.doc!==null?T(this.doc,t=>{this.forEach(function(n,r,s){_n(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ra)}},Sa=e=>new z,Tt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Es(e,t),Xe=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&W(),this.right.content.constructor){case O:this.right.deleted||xe(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},co=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case O:t.right.deleted||xe(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&$(e,k(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},wn=(e,t,n)=>{let r=new Map,s=Nn(t,n);if(s){let o=new Xe(s.p.left,s.p,s.index,r);return co(e,o,n-s.index)}else{let o=new Xe(null,t._start,0,r);return co(e,o,n)}},$o=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===O&&Tt(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,o=s.clientID;r.forEach((i,c)=>{let a=n.left,l=n.right,d=new A(k(o,I(s.store,o)),a,a&&a.lastId,l,l&&l.id,t,null,new O(c,i));d.integrate(e,0),n.right=d,n.forward()})},xe=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Po=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===O&&Tt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},qo=(e,t,n,r)=>{let s=e.doc,o=s.clientID,i=new Map;for(let c in r){let a=r[c],l=n.currentAttributes.get(c)||null;if(!Tt(l,a)){i.set(c,l);let{left:d,right:u}=n;n.right=new A(k(o,I(s.store,o)),d,d&&d.lastId,u,u&&u.id,t,null,new O(c,a)),n.right.integrate(e,0),n.forward()}}return i},Ur=(e,t,n,r,s)=>{n.currentAttributes.forEach((h,f)=>{s[f]===void 0&&(s[f]=null)});let o=e.doc,i=o.clientID;Po(n,s);let c=qo(e,t,n,s),a=r.constructor===String?new Z(r):r instanceof L?new Y(r):new pt(r),{left:l,right:d,index:u}=n;t._searchMarker&&Ze(t._searchMarker,n.index,a.getLength()),d=new A(k(i,I(o.store,i)),l,l&&l.lastId,d,d&&d.id,t,null,a),d.integrate(e,0),n.right=d,n.index=u,n.forward(),$o(e,t,n,c)},ao=(e,t,n,r,s)=>{let o=e.doc,i=o.clientID;Po(n,s);let c=qo(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===O));){if(!n.right.deleted)switch(n.right.content.constructor){case O:{let{key:a,value:l}=n.right.content,d=s[a];if(d!==void 0){if(Tt(d,l))c.delete(a);else{if(r===0)break t;c.set(a,l)}n.right.delete(e)}else n.currentAttributes.set(a,l);break}default:r<n.right.length&&$(e,k(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let a="";for(;r>0;r--)a+=`
`;n.right=new A(k(i,I(o.store,i)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Z(a)),n.right.integrate(e,0),n.forward()}$o(e,t,n,c)},zo=(e,t,n,r,s)=>{let o=n,i=_e(s);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===O&&xe(i,o.content),o=o.right;let c=0,a=!1;for(;t!==o;){if(n===t&&(a=!0),!t.deleted){let l=t.content;switch(l.constructor){case O:{let{key:d,value:u}=l;((i.get(d)||null)!==u||(r.get(d)||null)===u)&&(t.delete(e),c++,!a&&(s.get(d)||null)===u&&(r.get(d)||null)!==u&&s.delete(d));break}}}t=t.right}return c},ka=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===O){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Ho=e=>{let t=0;return T(e.doc,n=>{let r=e._start,s=e._start,o=H(),i=_e(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case O:xe(i,s.content);break;default:t+=zo(n,r,s,o,i),o=_e(i),r=s;break}s=s.right}}),t},lo=(e,t,n)=>{let r=n,s=_e(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Y:case pt:case Z:n<t.right.length&&$(e,k(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&zo(e,o,t.right,s,t.currentAttributes);let i=(t.left||t.right).parent;return i._searchMarker&&Ze(i._searchMarker,t.index,-r+n),t},Tn=class extends Yt{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];T(t,r=>{let s=new Map,o=new Map,i=this.target._start,c=null,a={},l="",d=0,u=0,h=()=>{if(c!==null){let f;switch(c){case"delete":f={delete:u},u=0;break;case"insert":f={insert:l},s.size>0&&(f.attributes={},s.forEach((y,x)=>{y!==null&&(f.attributes[x]=y)})),l="";break;case"retain":if(f={retain:d},Object.keys(a).length>0){f.attributes={};for(let y in a)f.attributes[y]=a[y]}d=0;break}n.push(f),c=null}};for(;i!==null;){switch(i.content.constructor){case Y:case pt:this.adds(i)?this.deletes(i)||(h(),c="insert",l=i.content.getContent()[0],h()):this.deletes(i)?(c!=="delete"&&(h(),c="delete"),u+=1):i.deleted||(c!=="retain"&&(h(),c="retain"),d+=1);break;case Z:this.adds(i)?this.deletes(i)||(c!=="insert"&&(h(),c="insert"),l+=i.content.str):this.deletes(i)?(c!=="delete"&&(h(),c="delete"),u+=i.length):i.deleted||(c!=="retain"&&(h(),c="retain"),d+=i.length);break;case O:{let{key:f,value:y}=i.content;if(this.adds(i)){if(!this.deletes(i)){let x=s.get(f)||null;Tt(x,y)?y!==null&&i.delete(r):(c==="retain"&&h(),Tt(y,o.get(f)||null)?delete a[f]:a[f]=y)}}else if(this.deletes(i)){o.set(f,y);let x=s.get(f)||null;Tt(x,y)||(c==="retain"&&h(),a[f]=x)}else if(!i.deleted){o.set(f,y);let x=a[f];x!==void 0&&(Tt(x,y)?x!==null&&i.delete(r):(c==="retain"&&h(),y===null?delete a[f]:a[f]=y))}i.deleted||(c==="insert"&&h(),xe(s,i.content));break}}i=i.right}for(h();n.length>0;){let f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},Ut=class extends L{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ut}clone(){let t=new Ut;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new Tn(this,t,n),s=t.doc;if(Bn(this,t,r),!t.local){let o=!1;for(let[i,c]of t.afterState.entries()){let a=t.beforeState.get(i)||0;if(c!==a&&(wo(t,s.store.clients.get(i),a,c,l=>{!l.deleted&&l.content.constructor===O&&(o=!0)}),o))break}o||jt(t,t.deleteSet,i=>{i instanceof P||o||i.parent===this&&i.content.constructor===O&&(o=!0)}),T(s,i=>{o?Ho(this):jt(i,i.deleteSet,c=>{c instanceof P||c.parent===this&&ka(i,c)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Z&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?T(this.doc,r=>{let s=new Xe(null,this._start,0,new Map);for(let o=0;o<t.length;o++){let i=t[o];if(i.insert!==void 0){let c=!n&&typeof i.insert=="string"&&o===t.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof c!="string"||c.length>0)&&Ur(r,this,s,c,i.attributes||{})}else i.retain!==void 0?ao(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&lo(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){let s=[],o=new Map,i=this.doc,c="",a=this._start;function l(){if(c.length>0){let d={},u=!1;o.forEach((f,y)=>{u=!0,d[y]=f});let h={insert:c};u&&(h.attributes=d),s.push(h),c=""}}return T(i,d=>{for(t&&bn(d,t),n&&bn(d,n);a!==null;){if(Wt(a,t)||n!==void 0&&Wt(a,n))switch(a.content.constructor){case Z:{let u=o.get("ychange");t!==void 0&&!Wt(a,t)?(u===void 0||u.user!==a.id.client||u.state!=="removed")&&(l(),o.set("ychange",r?r("removed",a.id):{type:"removed"})):n!==void 0&&!Wt(a,n)?(u===void 0||u.user!==a.id.client||u.state!=="added")&&(l(),o.set("ychange",r?r("added",a.id):{type:"added"})):u!==void 0&&(l(),o.delete("ychange")),c+=a.content.str;break}case Y:case pt:{l();let u={insert:a.content.getContent()[0]};if(o.size>0){let h={};u.attributes=h,o.forEach((f,y)=>{h[y]=f})}s.push(u);break}case O:Wt(a,t)&&(l(),xe(o,a.content));break}a=a.right}l()},bn),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?T(s,o=>{let i=wn(o,this,t);r||(r={},i.currentAttributes.forEach((c,a)=>{r[a]=c})),Ur(o,this,i,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){let s=this.doc;s!==null?T(s,o=>{let i=wn(o,this,t);Ur(o,this,i,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?T(r,s=>{lo(s,wn(s,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?T(s,o=>{let i=wn(o,this,t);i.right!==null&&ao(o,this,i,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?T(this.doc,n=>{_n(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?T(this.doc,r=>{zr(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Hr(this,t)}getAttributes(t){return Ro(this)}_write(t){t.writeTypeRef(Fa)}},Ua=e=>new Ut,Pe=class{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Nt||n.constructor===ft)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},ft=class extends L{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ft}clone(){let t=new ft;return t.insert(0,this.toArray().map(n=>n instanceof L?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Pe(this,t)}querySelector(t){t=t.toUpperCase();let r=new Pe(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Pe(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Bn(this,t,new In(this,n,t))}toString(){return Oo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Ye(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?T(this.doc,r=>{Mo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)T(this.doc,r=>{let s=t&&t instanceof L?t._item:t;Cn(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw vt("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?T(this.doc,r=>{Vo(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Lo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return No(this,t)}slice(t=0,n=this.length){return jo(this,t,n)}forEach(t){Ye(this,t)}_write(t){t.writeTypeRef(Pa)}},Ea=e=>new ft,Nt=class extends ft{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Nt(this.nodeName)}clone(){let t=new Nt(this.nodeName),n=this.getAttributes();for(let r in n)t.setAttribute(r,n[r]);return t.insert(0,this.toArray().map(r=>r instanceof L?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let c in t)r.push(c);r.sort();let s=r.length;for(let c=0;c<s;c++){let a=r[c];n.push(a+'="'+t[a]+'"')}let o=this.nodeName.toLocaleLowerCase(),i=n.length>0?" "+n.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?T(this.doc,n=>{_n(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?T(this.doc,r=>{zr(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Hr(this,t)}hasAttribute(t){return Fo(this,t)}getAttributes(t){return Ro(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),o=this.getAttributes();for(let i in o)s.setAttribute(i,o[i]);return Ye(this,i=>{s.appendChild(i.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef($a),t.writeKey(this.nodeName)}},va=e=>new Nt(e.readKey()),In=class extends Yt{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Xt=class extends z{constructor(t){super(),this.hookName=t}_copy(){return new Xt(this.hookName)}clone(){let t=new Xt(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(qa),t.writeKey(this.hookName)}},Ca=e=>new Xt(e.readKey()),Qt=class extends Ut{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Qt}clone(){let t=new Qt;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let o=[];for(let i in t.attributes[s])o.push({key:i,value:t.attributes[s][i]});o.sort((i,c)=>i.key<c.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let o=n[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){let c=o.attrs[i];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(za)}},_a=e=>new Qt,we=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw st()}mergeWith(t){return!1}write(t,n,r){throw st()}integrate(t,n){throw st()}},Aa=0,P=class extends we{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),yo(t.doc.store,this)}write(t,n){t.writeInfo(Aa),t.writeLen(this.length-n)}getMissing(t,n){return null}},Bt=class{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Bt(this.content)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},Da=e=>new Bt(e.readBuf()),Mt=class{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Mt(this.len)}splice(t){let n=new Mt(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){He(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},Ta=e=>new Mt(e.readLen()),Go=(e,t)=>new xt({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),te=class{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new te(Go(this.doc.guid,this.opts))}splice(t){throw st()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},Ia=e=>new te(Go(e.readString(),e.readAny())),pt=class{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new pt(this.embed)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},ja=e=>new pt(e.readJSON()),O=class{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new O(this.key,this.value)}splice(t){throw st()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},La=e=>new O(e.readKey(),e.readJSON()),ee=class{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ee(this.arr)}splice(t){let n=new ee(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},Oa=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new ee(n)},gt=class{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new gt(this.arr)}splice(t){let n=new gt(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeAny(o)}}getRef(){return 8}},Na=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new gt(n)},Z=class{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Z(this.str)}splice(t){let n=new Z(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},Ba=e=>new Z(e.readString()),Ma=[xa,Sa,Ua,va,Ea,Ca,_a],Va=0,Ra=1,Fa=2,$a=3,Pa=4,qa=5,za=6,Y=class{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Y(this.type._copy())}splice(t){throw st()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},Ha=e=>new Y(Ma[e.readTypeRef()](e)),Ir=(e,t)=>{let n=t,r=0,s;do r>0&&(n=k(n.client,n.clock+r)),s=$e(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof A);return{item:s,diff:r}},Gr=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},jn=(e,t,n)=>{let{client:r,clock:s}=t.id,o=new A(k(r,s+n),t,k(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=k(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},Jo=(e,t,n,r,s)=>{let o=e.doc,i=o.store,c=o.clientID,a=t.redone;if(a!==null)return $(e,a);let l=t.parent._item,d=null,u;if(l!==null&&l.deleted===!0){if(l.redone===null&&(!n.has(l)||Jo(e,l,n,r,s)===null))return null;for(;l.redone!==null;)l=$(e,l.redone)}let h=l===null?t.parent:l.content.type;if(t.parentSub===null){for(d=t.left,u=t;d!==null;){let U=d;for(;U!==null&&U.parent._item!==l;)U=U.redone===null?null:$(e,U.redone);if(U!==null&&U.parent._item===l){d=U;break}d=d.left}for(;u!==null;){let U=u;for(;U!==null&&U.parent._item!==l;)U=U.redone===null?null:$(e,U.redone);if(U!==null&&U.parent._item===l){u=U;break}u=u.right}}else if(u=null,t.right&&!s){for(d=t;d!==null&&d.right!==null&&be(r,d.right.id);)d=d.right;for(;d!==null&&d.redone!==null;)d=$(e,d.redone);if(d===null||d.parent._item!==l||d&&d.right!==null)return null}else d=h._map.get(t.parentSub)||null;let f=I(i,c),y=k(c,f),x=new A(y,d,d&&d.lastId,u,u&&u.id,h,t.parentSub,t.content.copy());return t.redone=y,Gr(x,!0),x.integrate(e,0),x},A=class extends we{constructor(t,n,r,s,o,i,c,a){super(t,a.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=c,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=I(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=I(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===bt&&this.id.client!==this.parent.client&&this.parent.clock>=I(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=no(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=$(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===P||this.right&&this.right.constructor===P)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===A&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===A&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===bt){let r=$e(n,this.parent);r.constructor===P?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=no(t,t.doc.store,k(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),Kt(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Kt(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has($e(t.doc.store,s.origin)))o.has($e(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),yo(t.doc.store,this),this.content.integrate(t,this),so(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new P(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:k(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Kt(t.origin,this.lastId)&&this.right===t&&Kt(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),He(t.deleteSet,this.id.client,this.id.clock,this.length),so(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw W();this.content.gc(t),n?na(t,this,new P(this.id,this.length)):this.content=new Mt(this.length)}write(t,n){let r=n>0?k(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(t.writeInfo(i),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let c=this.parent;if(c._item!==void 0){let a=c._item;if(a===null){let l=Rr(c);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===bt?(t.writeParentInfo(!1),t.writeLeftID(c)):W();o!==null&&t.writeString(o)}this.content.write(t,n)}},Wo=(e,t)=>Ga[t&31](e),Ga=[()=>{W()},Ta,Oa,Da,Ba,ja,La,Ha,Na,Ia,()=>{W()}],Ja=10,q=class extends we{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){W()}write(t,n){t.writeInfo(Ja),S(t.restEncoder,this.length-n)}getMissing(t,n){return null}},Ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Zo="__ $YJS$ __";Ko[Zo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ko[Zo]=!0;var Mn=ui(Xo());function Et(e){if(e instanceof L){e=e.toJSON();for(let[t,n]of Wr(e))Vt(e,t,n,Et)}if(Array.isArray(e))return e.map(Et);if(typeof e=="object"&&e!==null){let t={};for(let[n,r]of Object.entries(e))t[n]=Et(r);return t}return e}function Wa(e){return Array.isArray(e)?new M:typeof e=="object"&&e!==null?new z:e}function Wr(e){return Array.isArray(e)?[...e.entries()]:typeof e=="object"&&e!==null?Object.entries(e):e instanceof M?e.map((t,n)=>[n,t]):e instanceof z?[...e.entries()]:[]}function Vt(e,t,n,r=Wa){let s=r(n);if(e instanceof z){e.set(String(t),s),Wr(n).forEach(([o,i])=>{Vt(e.get(String(t)),o,i)});return}if(e instanceof M&&typeof t=="number"){e.length>t&&e.delete(t,1);let o=t-e.length;o>0&&e.push(Array(o).fill(null)),e.insert(t,[s]),Wr(n).forEach(([i,c])=>{Vt(e.get(t),i,c)});return}e[t]=s}function Kr(e,t,n){if(n.path&&n.path.length){let r=e.get(t),s,o=n.path.length-1;for(s=0;s<o;s++)switch(r=r.get(n.path[s]),n.kind){case"A":Kr(r.get(n.path[s]),n.index,n.item);break;case"D":r.delete(n.path[s],1);break;case"E":case"N":Vt(r,n.path[s],n.rhs);break}}else switch(n.kind){case"A":Kr(e.get(t),n.index,n.item);break;case"D":e.delete(t,1);break;case"E":case"N":Vt(e,t,n.rhs);break}return e}function Qo(e,t){if(e&&t&&t.kind){let n=e,r=-1,s=t.path?t.path.length-1:0;for(;++r<s;)typeof n.get(t.path?.[r])>"u"&&Vt(n,t.path?.[r],typeof t.path?.[r+1]=="number"?new M:new z),n=n.get(t.path?.[r]);switch(t.kind){case"A":t.path&&typeof n.get(t.path[r])>"u"&&Vt(n,t.path[r],new M),Kr(t.path?n.get(t.path[r]):n,t.index,t.item);break;case"D":n.delete(t.path?.[r],1);break;case"E":case"N":Vt(n,t.path?.[r],t.rhs);break}}}var Ka=["projects","templates","assets","snippets"],tn="livecodes-data",mt="data",Vn=self,X=ps(),Rn=async e=>{if(!e)return[];if("getValue"in e){let t=tr(e,X),n=await Wn(Vn,{method:"getValue",args:{storeKey:t}});return n!=null?[n]:[]}return e.getAllData()},ti=async(e,t)=>{if(e){if("setValue"in e){let n=tr(e,X);await Wn(Vn,{method:"setValue",args:{storeKey:n,value:t[0]}});return}await e.clear(),await e.restore(t)}},Se=(e,t=[])=>{let n=Mn.diff(Et(e),t)||[];e.doc?.transact(()=>{for(let r of n)Qo(e,r)})},Za=async({user:e,repo:t,branch:n,stores:r,storeKey:s,remoteContent:o})=>{let i=`${e.username}_${s}`,c=(await r.sync?.getItem(i))?.lastSyncSha,a=`${s}.b64.zip`,l=`${tn}/${a}`,d=r[s];if(!d||"getValue"in d)return!0;let h=new F.Doc;try{let f,y=o.find(w=>w.name===a)!=null,x=o.find(w=>w.sha===c)!=null,U=!y||x?void 0:await Ce({user:e,repo:t,branch:n,path:l});if(U?.content){let w=U.encoding==="arrayBuffer"?"binary":"base64";f=await nl(U.content,w)}let v=(await r.sync?.getItem(i))?.data,D=await Rn(d);if(v&&(F.applyUpdate(h,v),Se(h.getArray(mt),D),f&&F.applyUpdate(h,f)),!v&&!f&&Se(h.getArray(mt),D),!v&&f){let w=new F.Doc;F.applyUpdate(w,f);let _=Et(w.getArray(mt));w.destroy();let C=[..._,...D];Se(h.getArray(mt),C)}let B=Et(h.getArray(mt));Mn.diff(B,D)!=null&&await ti(d,B);let ne=F.encodeStateAsUpdate(h),g=!y||f&&!Jn(f,ne)||x&&v&&!Jn(v,ne);if(g){let w={path:l,content:await el([{filename:a.replace(".zip",""),content:ne}])};if(!await er({file:w,user:e,repo:t,branch:n,message:"sync "+s}))return!1}let p=(g?(await Ce({user:e,repo:t,branch:n,path:tn}))?.entries:o)?.find?.(w=>w.name===a)?.sha,b={lastModified:Date.now(),data:ne,lastSyncSha:p||""};await r.sync?.updateItem(i,b)}catch{return!1}finally{h.destroy()}return!0},Ya=async({user:e,repo:t,branch:n="main",newRepo:r})=>{let s=[];try{r?await er({file:{path:tn+"/.gitkeep",content:""},user:e,repo:t,branch:n,message:"create data dir",description:"LiveCodes Sync",newRepo:r,privateRepo:!0,readmeContent:"# LiveCodes Sync"}):(await Ce({user:e,repo:t,branch:n,path:""}))?.entries?.find?.(a=>a.type==="dir"&&a.name===tn)&&(s=(await Ce({user:e,repo:t,branch:n,path:tn}))?.entries)}catch{return!1}let o=!0,i=Object.keys(X).filter(c=>Ka.includes(c));for(let c of i)await Za({user:e,repo:t,branch:n,stores:X,storeKey:c,remoteContent:s})||(o=!1);return o},Xa=async({user:e,storeKey:t})=>{let n=`${e.username}_${t}`,r=X[t];if(!r)return;let{data:s,lastSyncSha:o=""}=await X.sync?.getItem(n)||{},i=await Rn(r),c=new F.Doc;try{s&&F.applyUpdate(c,s),Se(c.getArray(mt),i);let a=F.encodeStateAsUpdate(c),l={lastModified:Date.now(),data:a,lastSyncSha:o};await X.sync?.updateItem(n,l)}finally{c.destroy()}},Qa=async({storeKey:e})=>{let t=X[e];if(!t)return;let n=await Rn(t),r=new F.Doc;Se(r.getArray(mt),n);let s=F.encodeStateAsUpdate(r),o=os(s);return r.destroy(),o},ei=async({update:e,storeKey:t,mergeCurrent:n=!0})=>{let r=X[t];if(!r)return;let s="getValue"in r,o=await Rn(r),i=new F.Doc;try{if(F.applyUpdate(i,e),n){let l=Et(i.getArray(mt)),d=s?l:[...l,...o];Se(i.getArray(mt),d)}let c=Et(i.getArray(mt));Mn.diff(c,o)!=null&&await ti(r,c)}finally{i.destroy()}},tl=async({user:e,storeKey:t,mergeCurrent:n=!0})=>{let r=`${e.username}_${t}`;if(!X[t])return;let o=(await X.sync?.getItem(r))?.data;if(o)return ei({update:o,storeKey:t,mergeCurrent:n})},el=async e=>{let t=await ve(Zn,"JSZip"),n=new t;return e.forEach(({filename:r,content:s})=>{n.file(r,s)}),n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:6}})},nl=async(e,t)=>{let s=(await(await ve(Zn,"JSZip")).loadAsync(e,{base64:t==="base64"})).file(/.*\.b64/);if(s.length>0)return s[0].async("uint8array")};Vn.addEventListener("message",async e=>{X.projects||await gs(X,!1);let t=e.data,n;t.method==="sync"&&(n=await Ya(...t.args)),t.method==="exportToLocalSync"&&(n=await Xa(...t.args)),t.method==="exportStoreAsBase64Update"&&(n=await Qa(...t.args)),t.method==="restoreFromUpdate"&&(n=await ei(...t.args)),t.method==="restoreFromLocalSync"&&(n=await tl(...t.args)),Vn.postMessage({messageId:t.messageId,method:t.method,data:n})});
})();
