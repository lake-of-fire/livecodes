var q=async(a,v={})=>{let{appUrl:y="https://livecodes.io/",params:g={},config:l={},import:E,lite:k=!1,loading:L="lazy",template:H,view:z="split"}=v,o;if(typeof a=="string"?o=document.querySelector(a):o=a,!a)throw new Error("Container element is required.");if(!o)throw new Error(`Cannot find element: "${a}"`);let i;try{i=new URL(y)}catch(e){throw new Error(`"${y}" is not a valid URL.`)}let f=i.origin;if(typeof g=="object"&&Object.keys(g).forEach(e=>{i.searchParams.set(e,String(g[e]))}),typeof l=="string")try{new URL(l),i.searchParams.set("config",l)}catch(e){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof l=="object")Object.keys(l).length>0&&i.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');H&&i.searchParams.set("template",H),E&&i.searchParams.set("x",E),i.searchParams.set(k?"lite":"embed","true"),i.searchParams.set("loading",L),i.searchParams.set("view",z);let p=!1,b="Cannot call API methods after calling `destroy()`.",u=await(()=>new Promise(e=>{var m,P,d,w,c,S,R,T,U;if(!o)return;let r=o.dataset.height||o.style.height;if(r){let M=isNaN(Number(r))?r:r+"px";o.style.height=M}o.dataset.defaultStyles!=="false"&&((m=o.style).backgroundColor||(m.backgroundColor="#fff"),(P=o.style).border||(P.border="1px solid black"),(d=o.style).borderRadius||(d.borderRadius="5px"),(w=o.style).boxSizing||(w.boxSizing="border-box"),(c=o.style).padding||(c.padding="0"),(S=o.style).width||(S.width="100%"),(R=o.style).height||(R.height=o.style.height||"300px"),o.style.minHeight="200px",(T=o.style).overflow||(T.overflow="hidden"),(U=o.style).resize||(U.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let n=L==="eager"?"eager":"lazy";t.setAttribute("loading",n),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=o.style.borderRadius,addEventListener("message",function M(x){var O,j;x.source!==t.contentWindow||x.origin!==f||((O=x.data)==null?void 0:O.type)!=="livecodes-get-config"||(removeEventListener("message",M),(j=t.contentWindow)==null||j.postMessage({type:"livecodes-config",payload:l},f))}),t.onload=()=>{e(t)},t.src=i.href,o.innerHTML="",o.appendChild(t)}))(),C=new Promise(e=>{addEventListener("message",function r(t){var n;t.source!==u.contentWindow||t.origin!==f||((n=t.data)==null?void 0:n.type)!=="livecodes-ready"||(removeEventListener("message",r),e(),C.settled=!0)})}),I=()=>p?Promise.reject(b):new Promise(async e=>{var t;C.settled&&e();let r={type:"livecodes-load"};(t=u.contentWindow)==null||t.postMessage(r,f),await C,e()}),s=(e,r)=>new Promise(async(t,n)=>{var m;if(p)return n(b);await I(),addEventListener("message",function P(d){var w;if(!(d.source!==u.contentWindow||d.origin!==f||((w=d.data)==null?void 0:w.type)!=="livecodes-api-response")&&d.data.method===e){removeEventListener("message",P);let c=d.data.payload;c!=null&&c.error?n(c.error):t(c)}}),(m=u.contentWindow)==null||m.postMessage({method:e,args:r},f)}),h=[],N=e=>{if(p)throw new Error(b);return h.push(e),{remove:()=>{h=h.filter(r=>r!==e)}}};addEventListener("message",async e=>{var n;if(e.source!==u.contentWindow||e.origin!==f||((n=e.data)==null?void 0:n.type)!=="livecodes-change")return;let r=await s("getCode"),t=await s("getConfig");h.forEach(m=>{m({code:r,config:t})})});let A=()=>{h.length=0,o&&(o.innerHTML=""),p=!0};return L==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((r,t)=>{r.forEach(async n=>{n.isIntersecting&&(await I(),t.unobserve(o))})},{rootMargin:"150px"}).observe(o),{load:()=>I(),run:()=>s("run"),format:e=>s("format",[e]),getShareUrl:e=>s("getShareUrl",[e]),getConfig:e=>s("getConfig",[e]),setConfig:e=>s("setConfig",[e]),getCode:()=>s("getCode"),show:(e,r)=>s("show",[e,r]),runTests:()=>s("runTests"),onChange:e=>N(e),exec:(e,...r)=>s("exec",[e,...r]),destroy:()=>C.settled?s("destroy").then(A):p?Promise.reject(b):(A(),Promise.resolve())}},W;globalThis.document&&document.currentScript&&"prefill"in((W=document.currentScript)==null?void 0:W.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(a=>{let v,y=a.dataset.options;if(y)try{v=JSON.parse(y)}catch(E){}let g,l=a.dataset.config||a.dataset.prefill;if(l)try{g=JSON.parse(l)}catch(E){}q(a,{import:"dom/"+encodeURIComponent(a.outerHTML),...v,...g?{config:g}:{}})})});export{q as createPlayground};
