"use strict";var livecodes=(()=>{var H=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var D=(s,a)=>{for(var c in a)H(s,c,{get:a[c],enumerable:!0})},B=(s,a,c,g)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of Q(a))!$.call(s,n)&&n!==c&&H(s,n,{get:()=>a[n],enumerable:!(g=J(a,n))||g.enumerable});return s};var G=s=>B(H({},"__esModule",{value:!0}),s);var K={};D(K,{createPlayground:()=>z});var z=async(s,a={})=>{let{appUrl:c="https://livecodes.io/",params:g={},config:n={},import:E,lite:N=!1,loading:L="lazy",template:A,view:q="split"}=a,o;if(typeof s=="string"?o=document.querySelector(s):o=s,!s)throw new Error("Container element is required.");if(!o)throw new Error(`Cannot find element: "${s}"`);let d;try{d=new URL(c)}catch(e){throw new Error(`"${c}" is not a valid URL.`)}let y=d.origin;if(typeof g=="object"&&Object.keys(g).forEach(e=>{d.searchParams.set(e,String(g[e]))}),typeof n=="string")try{new URL(n),d.searchParams.set("config",n)}catch(e){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof n=="object")Object.keys(n).length>0&&d.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');A&&d.searchParams.set("template",A),E&&d.searchParams.set("x",E),d.searchParams.set(N?"lite":"embed","true"),d.searchParams.set("loading",L),d.searchParams.set("view",q);let u=!1,b="Cannot call API methods after calling `destroy()`.",h=await(()=>new Promise(e=>{var p,P,f,v,m,R,T,U,O;if(!o)return;let r=o.dataset.height||o.style.height;if(r){let M=isNaN(Number(r))?r:r+"px";o.style.height=M}o.dataset.defaultStyles!=="false"&&((p=o.style).backgroundColor||(p.backgroundColor="#fff"),(P=o.style).border||(P.border="1px solid black"),(f=o.style).borderRadius||(f.borderRadius="5px"),(v=o.style).boxSizing||(v.boxSizing="border-box"),(m=o.style).padding||(m.padding="0"),(R=o.style).width||(R.width="100%"),(T=o.style).height||(T.height=o.style.height||"300px"),o.style.minHeight="200px",(U=o.style).overflow||(U.overflow="hidden"),(O=o.style).resize||(O.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let l=L==="eager"?"eager":"lazy";t.setAttribute("loading",l),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=o.style.borderRadius,addEventListener("message",function M(x){var j,W;x.source!==t.contentWindow||x.origin!==y||((j=x.data)==null?void 0:j.type)!=="livecodes-get-config"||(removeEventListener("message",M),(W=t.contentWindow)==null||W.postMessage({type:"livecodes-config",payload:n},y))}),t.onload=()=>{e(t)},t.src=d.href,o.innerHTML="",o.appendChild(t)}))(),C=new Promise(e=>{addEventListener("message",function r(t){var l;t.source!==h.contentWindow||t.origin!==y||((l=t.data)==null?void 0:l.type)!=="livecodes-ready"||(removeEventListener("message",r),e(),C.settled=!0)})}),I=()=>u?Promise.reject(b):new Promise(async e=>{var t;C.settled&&e();let r={type:"livecodes-load"};(t=h.contentWindow)==null||t.postMessage(r,y),await C,e()}),i=(e,r)=>new Promise(async(t,l)=>{var p;if(u)return l(b);await I(),addEventListener("message",function P(f){var v;if(!(f.source!==h.contentWindow||f.origin!==y||((v=f.data)==null?void 0:v.type)!=="livecodes-api-response")&&f.data.method===e){removeEventListener("message",P);let m=f.data.payload;m!=null&&m.error?l(m.error):t(m)}}),(p=h.contentWindow)==null||p.postMessage({method:e,args:r},y)}),w=[],F=e=>{if(u)throw new Error(b);return w.push(e),{remove:()=>{w=w.filter(r=>r!==e)}}};addEventListener("message",async e=>{var l;if(e.source!==h.contentWindow||e.origin!==y||((l=e.data)==null?void 0:l.type)!=="livecodes-change")return;let r=await i("getCode"),t=await i("getConfig");w.forEach(p=>{p({code:r,config:t})})});let S=()=>{w.length=0,o&&(o.innerHTML=""),u=!0};return L==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((r,t)=>{r.forEach(async l=>{l.isIntersecting&&(await I(),t.unobserve(o))})},{rootMargin:"150px"}).observe(o),{load:()=>I(),run:()=>i("run"),format:e=>i("format",[e]),getShareUrl:e=>i("getShareUrl",[e]),getConfig:e=>i("getConfig",[e]),setConfig:e=>i("setConfig",[e]),getCode:()=>i("getCode"),show:(e,r)=>i("show",[e,r]),runTests:()=>i("runTests"),onChange:e=>F(e),exec:(e,...r)=>i("exec",[e,...r]),destroy:()=>C.settled?i("destroy").then(S):u?Promise.reject(b):(S(),Promise.resolve())}},k;globalThis.document&&document.currentScript&&"prefill"in((k=document.currentScript)==null?void 0:k.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(s=>{let a,c=s.dataset.options;if(c)try{a=JSON.parse(c)}catch(E){}let g,n=s.dataset.config||s.dataset.prefill;if(n)try{g=JSON.parse(n)}catch(E){}z(s,{import:"dom/"+encodeURIComponent(s.outerHTML),...a,...g?{config:g}:{}})})});return G(K);})();
