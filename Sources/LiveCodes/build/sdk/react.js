import D,{useEffect as F,useRef as J}from"react";var A=async(s,p={})=>{let{appUrl:m="https://livecodes.io/",params:d={},config:n={},import:h,lite:w=!1,loading:c="lazy",template:v,view:z="split"}=p,r;if(typeof s=="string"?r=document.querySelector(s):r=s,!s)throw new Error("Container element is required.");if(!r)throw new Error(`Cannot find element: "${s}"`);let l;try{l=new URL(m)}catch(e){throw new Error(`"${m}" is not a valid URL.`)}let y=l.origin;if(typeof d=="object"&&Object.keys(d).forEach(e=>{l.searchParams.set(e,String(d[e]))}),typeof n=="string")try{new URL(n),l.searchParams.set("config",n)}catch(e){throw new Error('"config" is not a valid URL or configuration object.')}else if(typeof n=="object")Object.keys(n).length>0&&l.searchParams.set("config","sdk");else throw new Error('"config" is not a valid URL or configuration object.');v&&l.searchParams.set("template",v),h&&l.searchParams.set("x",h),l.searchParams.set(w?"lite":"embed","true"),l.searchParams.set("loading",c),l.searchParams.set("view",z);let E=!1,L="Cannot call API methods after calling `destroy()`.",b=await(()=>new Promise(e=>{var u,M,g,P,f,T,O,U,k;if(!r)return;let o=r.dataset.height||r.style.height;if(o){let H=isNaN(Number(o))?o:o+"px";r.style.height=H}r.dataset.defaultStyles!=="false"&&((u=r.style).backgroundColor||(u.backgroundColor="#fff"),(M=r.style).border||(M.border="1px solid black"),(g=r.style).borderRadius||(g.borderRadius="5px"),(P=r.style).boxSizing||(P.boxSizing="border-box"),(f=r.style).padding||(f.padding="0"),(T=r.style).width||(T.width="100%"),(O=r.style).height||(O.height=r.style.height||"300px"),r.style.minHeight="200px",(U=r.style).overflow||(U.overflow="hidden"),(k=r.style).resize||(k.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let a=c==="eager"?"eager":"lazy";t.setAttribute("loading",a),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=r.style.borderRadius,addEventListener("message",function H(I){var N,j;I.source!==t.contentWindow||I.origin!==y||((N=I.data)==null?void 0:N.type)!=="livecodes-get-config"||(removeEventListener("message",H),(j=t.contentWindow)==null||j.postMessage({type:"livecodes-config",payload:n},y))}),t.onload=()=>{e(t)},t.src=l.href,r.innerHTML="",r.appendChild(t)}))(),x=new Promise(e=>{addEventListener("message",function o(t){var a;t.source!==b.contentWindow||t.origin!==y||((a=t.data)==null?void 0:a.type)!=="livecodes-ready"||(removeEventListener("message",o),e(),x.settled=!0)})}),R=()=>E?Promise.reject(L):new Promise(async e=>{var t;x.settled&&e();let o={type:"livecodes-load"};(t=b.contentWindow)==null||t.postMessage(o,y),await x,e()}),i=(e,o)=>new Promise(async(t,a)=>{var u;if(E)return a(L);await R(),addEventListener("message",function M(g){var P;if(!(g.source!==b.contentWindow||g.origin!==y||((P=g.data)==null?void 0:P.type)!=="livecodes-api-response")&&g.data.method===e){removeEventListener("message",M);let f=g.data.payload;f!=null&&f.error?a(f.error):t(f)}}),(u=b.contentWindow)==null||u.postMessage({method:e,args:o},y)}),C=[],q=e=>{if(E)throw new Error(L);return C.push(e),{remove:()=>{C=C.filter(o=>o!==e)}}};addEventListener("message",async e=>{var a;if(e.source!==b.contentWindow||e.origin!==y||((a=e.data)==null?void 0:a.type)!=="livecodes-change")return;let o=await i("getCode"),t=await i("getConfig");C.forEach(u=>{u({code:o,config:t})})});let S=()=>{C.length=0,r&&(r.innerHTML=""),E=!0};return c==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((o,t)=>{o.forEach(async a=>{a.isIntersecting&&(await R(),t.unobserve(r))})},{rootMargin:"150px"}).observe(r),{load:()=>R(),run:()=>i("run"),format:e=>i("format",[e]),getShareUrl:e=>i("getShareUrl",[e]),getConfig:e=>i("getConfig",[e]),setConfig:e=>i("setConfig",[e]),getCode:()=>i("getCode"),show:(e,o)=>i("show",[e,o]),runTests:()=>i("runTests"),onChange:e=>q(e),exec:(e,...o)=>i("exec",[e,...o]),destroy:()=>x.settled?i("destroy").then(S):E?Promise.reject(L):(S(),Promise.resolve())}},W;globalThis.document&&document.currentScript&&"prefill"in((W=document.currentScript)==null?void 0:W.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(s=>{let p,m=s.dataset.options;if(m)try{p=JSON.parse(m)}catch(h){}let d,n=s.dataset.config||s.dataset.prefill;if(n)try{d=JSON.parse(n)}catch(h){}A(s,{import:"dom/"+encodeURIComponent(s.outerHTML),...p,...d?{config:d}:{}})})});function Q(s){let{className:p,style:m,height:d,sdkReady:n,...h}=s,w=J(null),c;return F(()=>{if(w.current)return A(w.current,h).then(v=>{c=v,typeof n=="function"&&n(v)}),()=>{c==null||c.destroy()}},[]),D.createElement("div",{ref:w,className:p,style:m,"data-height":d})}export{Q as default};
